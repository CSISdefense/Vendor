---
title: "Ceiling Breach"
author: "Greg Sanders"
date: "Wednesday, February 8, 2017"
output:
  html_document:
    keep_md: yes
--- 

Modeling Size f  Contract Breaches for those Contracts that Breached
============================================================================

#Setup

First we load the data. The dataset used is a U.S. Defense Contracting dataset derived from FPDS.

The final sample uses 1 million rows of data, but as a computation shortcut, only a subset of the data is needed to allow for processing of models in minutes rather than hours.


```{r Libraries, echo = FALSE}
library(csis360)
library(ggplot2)
library(dplyr)
library(arm)
library(Hmisc)
library(sjstats)
source("..\\scripts\\DIIGstat.r")
source("..\\scripts\\NAICS.r")

axis.text.size<-10
strip.text.size<-10
legend.text.size<-8
# table.text.size<-5.75
title.text.size<-12
geom.text.size<-12

main.text.size<-1
note.text.size<-1.40

load(file="..//data//clean//def_sample.Rdata")

contract_transform_verify(def_breach,dollars_suffix="Then_Year",just_check_na=TRUE)
```

Contracts are classified using a mix of numerical and categorical variables. While the changes in numerical variables are easy to grasp and summarize, a contract may have one line item that is competed and another that is not. As is detailed in the exploration on R&D, we are only considering information available prior to contract start. The percentage of contract obligations that were competed is a valuable benchmark, but is highly influenced by factors that occured after contract start.

##Prepare Data

### Contract Ceiling Breaches

Contract Ceiling Breaches and the number of change orders can be calculated for the entire sample.  Change orders are determined using the *Reason for Modification* field in FPDS. 

#Level-1 Regression Model

##Study Variable: Competition
Competition has the potential to reduce terminations by giving the government more options in vendors and encouraging better behavior from the contractor that was chosen. 

###Model 01A: No Competition / Number of Offer Categories 

```{r Model01A}

#Frequency Plot
summary_discrete_plot(def_breach,"CompOffr",metric="cbre")

#Model
ln_CBre_Comp_01A <- glm (data=def_breach,
                 ln_CBre_Then_Year ~ CompOffr)
summary(ln_CBre_Comp_01A)
summary_residual_compare(ln_CBre_Comp_01A,bins=2, skip_vif=TRUE)

```

For ceiling breaches, no competition is associated with larger magnitude breaches in line with expectations. Contrary to expectations, so competition with 5+ offers is only a bit below that. The other results are in line with expectations, with 3-4 offers is associated with the smallest size of breaches and perhaps surprisingly single offer competition having similar results as competition with two offers.

## Study Variable Consolidation

### Level 6
#### Model NCS6A: l_def6_HHI_lag1

Expectations is that more consolidation is assoiated a change in occurance of breaches.
```{r ModelNCS6A}
#Frequency Plot for unlogged ceiling
summary_continuous_plot(def_breach,"def6_HHI_lag1",metric="cbre")
summary_continuous_plot(def_breach,"def6_HHI_lag1",metric="cbre",log=TRUE)
summary_continuous_plot(def_breach,"def3_HHI_lag1",metric="cbre")
summary_continuous_plot(def_breach,"def3_HHI_lag1",metric="cbre",log=TRUE)


#Model
ln_CBre_Cons_NCS6A <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1)
summary(ln_CBre_Cons_NCS6A)


#Plot residuals versus fitted
  stargazer::stargazer(ln_CBre_Comp_01A,ln_CBre_Cons_NCS6A,type="text",
                       digits=2)
  
#For first model in category, include only the new model(s), skip_vif=true
summary_residual_compare(ln_CBre_Cons_NCS6A,bins=20,skip_vif = TRUE)


```

Expectation is are upheld with a negative sign.

#### Model NCS6B: Defense to Overall ratio
The higher the ratio of defense obligations to reciepts in the overall economy, the DoD holds a monosopy over a sector. Given the challenges of monosopy, the a higher ratio estimates a greater  risk of ceiling breaches.
```{r ModelNCS6B}
#Frequency Plot for unlogged ceiling
summary_continuous_plot(def_breach,"capped_def6_ratio_lag1",metric="cbre")
      summary_continuous_plot(def_breach,"capped_def6_ratio_lag1",metric="cbre",log=TRUE)

      summary_continuous_plot(def_breach,"capped_def3_ratio_lag1",metric="cbre")
      summary_continuous_plot(def_breach,"capped_def3_ratio_lag1",metric="cbre",log=TRUE)



#Model
ln_CBre_NCS6B <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_ratio_lag1)
summary(ln_CBre_NCS6B)

# 
# #Plot the fitted model plot
# ln_CBre_02A_curve<-function(x, Comp){invlogit(cbind(1,Comp,x) %*%  coef(ln_CBre_02A))}
# 
# #Competition curves
# fitted_ln_CBre_model(def_breach,"cl_Ceil_Then_Year") + stat_function(fun = ln_CBre_02A_curve, 
#                              args=list(Comp=0),color="blue")+
#   stat_function(fun = ln_CBre_02A_curve, 
#                              args=list(Comp=2),color="blue")



#Plot residuals versus fitted
  stargazer::stargazer(ln_CBre_Cons_NCS6A,ln_CBre_NCS6B,
                       ln_CBre_Comp_01A,type="text",
                       digits=2)


#For first model in category, include only the new model(s), skip_vif=true
summary_residual_compare(ln_CBre_NCS6B,skip_vif=TRUE,bins=10)


```
The results align with expectations, when ratio is  logged.


#### Model NCS6C: cl_def6_obl_lag1
Defense sector obligations are added to better adjust for the fact that larger sectors tend to have lower HHI indices if only because they include a broader range of activities. In addition, Acting somewhat as a proxy for MDAP status, larger sectors may also have a greater risk of cascading problems. Thus greater defense obligations in a given sector are expected to estimate a greater likelihood over ceiling breaches,
Expectations are  unchanged.
```{r ModelNCS6C}

summary_continuous_plot(def_breach,"cl_def6_obl_lag1",metric="cbre")
      summary_continuous_plot(def_breach,"cl_def6_obl_lag1",metric="cbre",log=TRUE)


#Model
ln_CBre_NCS6C <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_obl_lag1)
summary(ln_CBre_NCS6C)

#Plot residuals versus fitted
stargazer::stargazer(ln_CBre_Cons_NCS6A,ln_CBre_NCS6B,ln_CBre_NCS6C,
                       type="text",
                       digits=2)


#For first model in category, include only the new model(s), skip_vif=true
summary_residual_compare(ln_CBre_NCS6C,bins=10,skip_vif = TRUE)


```
The result runs contrary to expectation. 

#### Model NCS6D: Average Salary
Average salary can be an proxy for unobserved skill requirements. We expect that a greater skill requirement will estimate a greater risk of ceiling breaches.
```{r ModelNCS6D}
#Frequency Plot for unlogged ceiling

summary_continuous_plot(def_breach,"US6_avg_sal_lag1",metric="cbre")
summary_continuous_plot(def_breach,"US6_avg_sal_lag1",metric="cbre" ,log=TRUE)

#Model

ln_CBre_NCS6D <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_US6_avg_sal_lag1 )
summary(ln_CBre_NCS6D)



#Plot residuals versus fitted
stargazer::stargazer(ln_CBre_Cons_NCS6A,ln_CBre_NCS6B,ln_CBre_NCS6C,ln_CBre_NCS6D,
                       type="text",
                       digits=2)


# For individual models, only the new model(s) unless they have a clear counterpart or alternate, skip_vif=true
summary_residual_compare(ln_CBre_NCS6D,bins=10,skip_vif = TRUE)

```
Results align with expectations. Interestingly, this had not been true in the logit model, suggesting that larger salary may be associated with less frequent but greater magnitude breaches.

#### Model NCS6E: Cumulative
```{r ModelNCS6l}
#Model
ln_CBre_Cons_NCS6E <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1)
glmer_examine(ln_CBre_Cons_NCS6E)

ln_CBre_Comp_NCS6E <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1)
glmer_examine(ln_CBre_Comp_NCS6E)
# 


#Plot residuals versus fitted
  stargazer::stargazer(ln_CBre_Cons_NCS6A,ln_CBre_NCS6B,ln_CBre_NCS6C,ln_CBre_NCS6D,ln_CBre_Cons_NCS6E,
                       ln_CBre_Comp_01A,ln_CBre_Comp_NCS6E,type="text",
                       digits=2)

#For the first cumulative model(s) compare to compnent study variables, skip_vif =false
summary_residual_compare(ln_CBre_Cons_NCS6A,ln_CBre_Cons_NCS6E,bins=10)
summary_residual_compare(ln_CBre_Comp_01A,ln_CBre_Comp_NCS6E,bins=2)


```
With the ceiling breach model, when combined magnitudes are reduced but the signs are unchanged.

With competition, the sign flips for ratio and average salary, in both cases turning it contrary to expectation.

### Level 3
#### Model NCS3A: cl_def3_HHI
As with NAICS6, consolidation is expected to influence ceiling breach occurance/size, but the direction is not predicted.
```{r ModelNCS3A}
#Frequency Plot for unlogged ceiling
summary_continuous_plot(def_breach,"def3_HHI_lag1",metric="cbre")
summary_continuous_plot(def_breach,"def3_HHI_lag1",metric="cbre",log=TRUE)

#Model
ln_CBre_Cons_NCS3A <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def3_HHI_lag1)
summary(ln_CBre_Cons_NCS3A)


#Plot residuals versus fitted
stargazer::stargazer(ln_CBre_Cons_NCS6A,ln_CBre_Cons_NCS6E,ln_CBre_Cons_NCS3A,
                       ln_CBre_Comp_01A,ln_CBre_Comp_NCS6E,type="text",
                       digits=2)


#For subsequent models in category, compare to prior in category or prior highly relevant, skip_vif=true
summary_residual_compare(ln_CBre_Cons_NCS6A,ln_CBre_Cons_NCS3A,bins=20,skip_vif=TRUE)


```

Expectations are upheld with a negative sign. That said, this seems to turn around some at the high end of the scale.

#### Model NCS3B: Defense to Overall ratio
The higher the ratio of defense obligations to reciepts in the overall economy, the DoD holds a monosopy over a sector. Given the challenges of monosopy, the a higher ratio estimates a greater  risk of ceiling breaches.
```{r ModelNCS3l}
#Frequency Plot for unlogged ceiling


summary_continuous_plot(def_breach,"capped_def3_ratio_lag1",metric="cbre")
summary_continuous_plot(def_breach,"capped_def3_ratio_lag1",metric="cbre",log=TRUE)

#Model
ln_CBre_NCS3B <- glm (data=def_breach,
                 ln_CBre_Then_Year ~ cl_def3_ratio_lag1)
summary(ln_CBre_NCS3B)
# 
stargazer::stargazer(ln_CBre_NCS3B,ln_CBre_NCS6B,ln_CBre_Cons_NCS6A,ln_CBre_Cons_NCS6E,
                       ln_CBre_Comp_01A,ln_CBre_Comp_NCS6E,
                     type="text",
                       digits=2)

#For subsequent models in category, compare to prior in category or prior highly relevant, skip_vif=true
summary_residual_compare(ln_CBre_NCS6B,ln_CBre_NCS3B,bins=5,skip_vif = TRUE)



```
The results align with the hypothesis and the magnitude is larger than the level 6 version.

#### Model NCS3C: Cumulative Model
Consolidation at lessa nd more granular levels may have different effects. Efficiencies are often used to describe sectors, like utilities, with high barriers to entry. Many of these aspects seem like they would already be captured at less granular NAICS levels, e.g. power plants, rather than more specific NAICS levels, like solar vs. coal. As a result, consolidation for more granular NAICS codes should estimate higher rates of ceiling breaches compared to less granular NAICS code.

We'll start by adding in everything from both models and seeing what violates VIF.
```{r ModelNCS3C}
#Frequency Plot for unlogged ceiling



#Model
ln_CBre_Cons_NCS3C <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1)
glmer_examine(ln_CBre_Cons_NCS3C)


ln_CBre_Cons_NCS3C2 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1)
glmer_examine(ln_CBre_Cons_NCS3C2)

ln_CBre_Cons_NCS3C3 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1)
glmer_examine(ln_CBre_Cons_NCS3C3)

ln_CBre_Comp_NCS3C <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+
                   cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_ratio_lag1)
glmer_examine(ln_CBre_Comp_NCS3C)
# 
ln_CBre_Comp_NCS3C2 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+
                   cl_def6_ratio_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_ratio_lag1)
glmer_examine(ln_CBre_Comp_NCS3C2)

#Plot residuals versus fitted
  stargazer::stargazer(ln_CBre_Cons_NCS6A,ln_CBre_Cons_NCS6E,
                       ln_CBre_Cons_NCS3A,ln_CBre_NCS3B,ln_CBre_Cons_NCS3C3,
                       type="text",
                       digits=2)
stargazer::stargazer(ln_CBre_Comp_01A,ln_CBre_Comp_NCS6E,ln_CBre_Comp_NCS3C2,type="text",
                       digits=2)


# 
# #Plot the fitted model plot
# ln_CBre_02A_curve<-function(x, Comp){invlogit(cbind(1,Comp,x) %*%  coef(ln_CBre_02A))}
# 
# #Competition curves
# fitted_ln_CBre_model(def_breach,"cl_Ceil_Then_Year") + stat_function(fun = ln_CBre_02A_curve, 
#                              args=list(Comp=0),color="blue")+
#   stat_function(fun = ln_CBre_02A_curve, 
#                              args=list(Comp=2),color="blue")


#ompare with cumulative consolidation and competition
summary_residual_compare(ln_CBre_Cons_NCS6E,ln_CBre_Cons_NCS3C3,ln_CBre_Comp_NCS6E,ln_CBre_Comp_NCS3C2,bins=10)

```
Dropping defense obligations in both models due to VIF challenges in the consolidation model and a desire to maintain consistency between the models.

Def 6 HHI grows  in magnitude. Def 3 ratio greatly reduces in magnitude for competition, though retains signficance. Also in the competition model, average salary and def 6 ratio reverses itself,  resuming the expected direction.
Otherwise some reduction in magnitude, e.g. for 5 offers in the competition model and def3 hhi in the consolidation model.

In the residuals, the high end fitted values appear to overestimate the size of breach. Also worth watching the vif for the two HHI variables remains high in the consolidation model.

##Scope Variables
###Model 02A: Cost Ceiling


```{r Model02A}
#Frequency Plot for unlogged ceiling
summary_continuous_plot(def_breach,"UnmodifiedCeiling_Then_Year",metric="cbre",
               bins=1000)
#Frequency Plot for logged ceiling
summary_continuous_plot(def_breach,"UnmodifiedCeiling_Then_Year",metric="cbre",
               log=TRUE)


#Model
ln_CBre_02A <- glm (data=def_breach,
                 ln_CBre_Then_Year ~ cl_Ceil_Then_Year)
summary(ln_CBre_02A)

#Plot residuals versus fitted
stargazer::stargazer(ln_CBre_02A,ln_CBre_Cons_NCS3C3,
                       ln_CBre_Comp_NCS3C2,type="text",
                       digits=2)


#For first model in category, include only the new model(s), skip_vif=true
summary_residual_compare(ln_CBre_02A,bins=20,skip_vif = TRUE)

```

Contract ceiling has a significant relationship, the largest magnitude of the models yet included, and more explanatory power than the previous cumulative model. The only challenge notable in the residuals is that it at little predictive power at the bottom of the scale. Perhaps extremely small ceiling values are less reliable or may simply be that they are fairly rarely reported as they are below the minimum reporting threshold.

###Model 02B: Maximum Duration


```{r Model02B}
#Frequency Plot for max duration
summary_continuous_plot(def_breach,"UnmodifiedDays",
               bins=1000,metric="cbre")

#Frequency Plot for logged max duration
summary_continuous_plot(def_breach,"UnmodifiedDays", metric="cbre",log=TRUE)

#Model
ln_CBre_02B <- glm (data=def_breach,
                 ln_CBre_Then_Year ~ cl_Days )
summary(ln_CBre_02B)


stargazer::stargazer(ln_CBre_02A,ln_CBre_02B,ln_CBre_Cons_NCS3C3,
                       ln_CBre_Comp_NCS3C2,type="text",
                       digits=2)



#Compare with prior in category
summary_residual_compare(ln_CBre_02B,bins=10,skip_vif = TRUE)

```
Initial duration has the expected relationship, though not as strongly as ceiling, but still stronger than all other variables combined. The results get a bit odd for very short duration contracts, but otherwise the residuals give no cause for concern.

###Model 02C: Both Scope
Given the extrordinary power of ceiling and duration, we take the extra step of creating a combined model to understand how they interact before leaping into the cumulative model.

```{r Model02C}
#Model
ln_CBre_02C <- glm (data=def_breach,
                 ln_CBre_Then_Year ~ cl_Ceil_Then_Year+ cl_Days )
summary(ln_CBre_02C)


stargazer::stargazer(ln_CBre_02A,ln_CBre_02B,ln_CBre_02C,ln_CBre_Cons_NCS3C3,
                       ln_CBre_Comp_NCS3C2,type="text",
                       digits=2)

#ompare with cumulative consolidation and competition
summary_residual_compare(ln_CBre_Cons_NCS3C3,ln_CBre_02C,ln_CBre_Comp_NCS6E,ln_CBre_02C,bins=10,skip_vif = FALSE)



```
Including both moderates substantially moderates the  influence of days and slightly moderates the influence  of ceiling. This is in keeping with the idea that breach sizes are typically proportionate to the overall size of the contract, while still allowing for a role of duration regardless of contract size.

The  comparison to the prior consolidated models are romising. while both of the day+ceiling models still have trouble predicting with low fitted values, they do much better than the cons model with high values and have smaller  residuals than both prior models.

###Model 02D: Cumulative 


```{r Model02D}
#Model
ln_CBre_02C <- glm (data=def_breach,
                 ln_CBre_Then_Year ~ cl_Ceil_Then_Year+ cl_Days )
summary(ln_CBre_02C)



#Model
ln_CBre_Cons_02D <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days)
glmer_examine(ln_CBre_Cons_02D)

ln_CBre_Comp_02D <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+
                   cl_def6_ratio_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days)
glmer_examine(ln_CBre_Comp_02D)




stargazer::stargazer(ln_CBre_02C,ln_CBre_Cons_NCS3C3,ln_CBre_Cons_02D,
                       ln_CBre_Comp_NCS3C2,ln_CBre_Comp_02D,type="text",
                       digits=2)

#ompare with cumulative consolidation and competition
summary_residual_compare(ln_CBre_Cons_NCS3C3,ln_CBre_Cons_02D,ln_CBre_Comp_NCS6E,ln_CBre_Comp_02D,bins=10)


if(exists("ln_CBre_NCS6D")){
  #Drop models  not used in NAICS3 comparisons
  # rm(ln_CBre_NCS6D)
  #Drop individual models that  aren't study  variables.
  rm(ln_CBre_NCS3B)
  #Drop NAICS6 models used in NAICS3 comparisons, execept original HHI
  rm(ln_CBre_NCS6B)
}

```
Adding ceiling and duration across the board reduces amgnitudes, with the only exceptions being ratio 3 and competition with  or more offers in the competition model. Average salary loses significance and swaps sign, though with the magnitude being so close to  zero as a result the swap may not be that meaningful Likewise def3 HHI loses significance.

One worrisome result is that HHI6 is now quite close to the threshold of a VIF of 2, with HHi3 not that far behind. If this keeps up, one or the other will likely need to be  removed. At present, def6 would appear to be the version to keep.

###Model 02E: Cumulative 


```{r Model02E}
#Model
ln_CBre_02C <- glm (data=def_breach,
                 ln_CBre_Then_Year ~ cl_Ceil_Then_Year+ cl_Days )
summary(ln_CBre_02C)



#Model
ln_CBre_Cons_02E <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days)
glmer_examine(ln_CBre_Cons_02E)

ln_CBre_Comp_02E <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+
                   cl_def6_ratio_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days)
glmer_examine(ln_CBre_Comp_02E)




stargazer::stargazer(ln_CBre_02C,ln_CBre_Cons_NCS3C3,ln_CBre_Cons_02E,
                       ln_CBre_Comp_NCS3C2,ln_CBre_Comp_02E,type="text",
                       digits=2)

#ompare with cumulative consolidation and competition
summary_residual_compare(ln_CBre_Cons_NCS3C3,ln_CBre_Cons_02E,ln_CBre_Comp_NCS6E,ln_CBre_Comp_02E,bins=10)


if(exists("ln_CBre_NCS6D")){
  #Drop models  not used in NAICS3 comparisons
  # rm(ln_CBre_NCS6D)
  #Drop individual models that  aren't study  variables.
  rm(ln_CBre_NCS3B)
  #Drop NAICS6 models used in NAICS3 comparisons, execept original HHI
  rm(ln_CBre_NCS6B)
}

```


##Contract Vehicle
Our dataset includes both stand alone contract awards and task orders that are under larger indefinite delivery vehilces (IDVs). 

###Model 03A: Single-Award, Multi-Award, and Other Indefinite Delivery Vehicles
Expectations, lower ceiling breaches for IDVs in general, in particular for FSS/GWAC

```{r Model03A}
#Frequency Plot
summary_discrete_plot(def_breach,"Veh",metric="cbre")


#Create the model
ln_CBre_03A <- glm (data=def_breach,
                 ln_CBre_Then_Year ~ Veh)
summary(ln_CBre_03A)



stargazer::stargazer(ln_CBre_03A,ln_CBre_Cons_02D,
                       ln_CBre_Comp_02D,type="text",
                       digits=2)

#For first model in category, include only the new model(s), skip_vif=true
summary_residual_compare(ln_CBre_03A,bins=3,skip_vif = TRUE)

```

Expectation partially holds. Multiple award IDCs have larger than usual breaches and FSS/GWACs do indeed have smaller breaches, but not smaller  than BPA/BOAs.


###Model 03B: Cumulative

```{r Model03B}
#Model
ln_CBre_Cons_03B <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh)
glmer_examine(ln_CBre_Cons_03B)

ln_CBre_Cons_03B2 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh)
glmer_examine(ln_CBre_Cons_03B2)

ln_CBre_Comp_03B <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+
                   cl_def6_ratio_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh)
glmer_examine(ln_CBre_Comp_03B)




stargazer::stargazer(ln_CBre_03A,ln_CBre_Cons_02D,ln_CBre_Cons_03B,
                       ln_CBre_Comp_02D,ln_CBre_Comp_03B,type="text",
                       digits=2)



#Compare to prior cumulative model(s), skip_vif =false
summary_residual_compare(ln_CBre_Cons_02D,ln_CBre_Cons_03B,ln_CBre_Comp_02D,ln_CBre_Comp_03B,bins=10,skip_vif = FALSE)
#Remove all but cumulative model
if(exists("ln_CBre_02B"))  rm(ln_CBre_02B,ln_CBre_02C)


```
Intriguingly, Multi-award IDCs and BPA/BOAs both experience dramatic  reductions in magnitude, with M-IDC outright flipping into the expected direction for the consolidation model and BPA/BOA flipping in the unexpected direction (towards larger breaches) for both models. 

Introduction of vehicle improves the VIF situation dramaticall, It would in theory allow reintroduction of defense obligations, although that does bring the VIF for HHi6 back over 1.5 and obligations would have the 2nd highest VIF just under 1.5, so probably safest to leave it out.

##Type of Contract

The next step adds a measure for whether the contract was cost-based or fixed-price. Prior CSIS research has found that fixed-price contracts do face a higher risk of termination across the board.

###Model 04A: Incentive Fees

Fixed-price contracts are generally thought to be at greater risk of overruns, as they are less flexible, although prior CSIS work complicates this finding.

In the performance of the defense acquisition system report, the benefits found were reduced cost overruns. That could help avoid terminations, but it's an indirect connection at best. Unfortunately, incentive fees are incredibly rare, which makes them challenging to examine directly.


```{r Model04A}

#Frequency Plot
summary_discrete_plot(def_breach,"PricingFee",metric="cbre")




#Create the model
ln_CBre_04A <- glm (data=def_breach,
                 ln_CBre_Then_Year ~PricingFee)
summary(ln_CBre_04A)



stargazer::stargazer(ln_CBre_04A,ln_CBre_Cons_03B,
                       ln_CBre_Comp_03B,type="text",
                       digits=2)





#For first model in category, include only the new model(s), skip_vif=true
summary_residual_compare(ln_CBre_04A,bins=2,skip_vif = TRUE)


```
Expectations are not particularly met, incentive fees have a lower coefficient than cost based, other fixed price is lowest with the exception of the  baseline of firm fixed price..



###Model 04B: Undefinitized Contract Awards
Undefinitized Contract Awards allow for quick action in situations where there is not time or information to establish all of a contracts properties at the time of signing. They have been found by the GAO and the Performance of the Defense Acquisition studies to contain notable risks, primarily relating to cost overruns and thus ceiling breaches. Will these risks also carry into terminations and ceiling breaches?


```{r Model04B}

#Frequency Plot
summary_discrete_plot(def_breach,"UCA",metric="cbre")



#Create the model
ln_CBre_04B <- glm (data=def_breach,
                 ln_CBre_Then_Year ~ b_UCA )
summary(ln_CBre_04B)


stargazer::stargazer(ln_CBre_04A,ln_CBre_04B,ln_CBre_Cons_03B,
                       ln_CBre_Comp_03B,type="text",
                       digits=2)


#Compare to earlier contract types
summary_residual_compare(ln_CBre_04A,ln_CBre_04B,bins=2,skip_vif = TRUE)


```
UCAs are associated with larger ceiling breaches, as expected.

###Model 04C: Cumulative

```{r Model04C}
#Create the model
ln_CBre_Cons_04C <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA)
glmer_examine(ln_CBre_Cons_04C)

ln_CBre_Comp_04C <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+
                   cl_def6_ratio_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA)
glmer_examine(ln_CBre_Comp_04C)



stargazer::stargazer(ln_CBre_04A,ln_CBre_04B,ln_CBre_Cons_03B,ln_CBre_Cons_04C,
                       ln_CBre_Comp_03B,ln_CBre_Comp_04C,type="text",
                       digits=2)


#Compare with cumulative consolidation and competition
summary_residual_compare(ln_CBre_Cons_03B,ln_CBre_Comp_04C,ln_CBre_Comp_03B,ln_CBre_Comp_04C,bins=20,skip_vif = TRUE)


if(exists("ln_CBre_03A")) rm(ln_CBre_03A)

```


Salary gains signifance in an unexpected direction, though magnitude remains small. Introduction to the cumulative model changes little for UCA but does moderate magnitudes for pricing. Other fixed fee now has a negative sign, significantly so for competition.  Incentive fee  still  has  a positive  sign, though lower in magnitude than the cost based/combined/Time and Materials/Labor Hours/Level of effort options. That last category has the largest coefficient, perhaps suggesting that the comparative simplicity of those contracts do not do the best job in containing costs when a breach occurs.

##Place of Performance
###Model 05A: Any International

International contracts may often be in conflict zones and thus experience greater risk. International contracts are exepected to estimate a greater size of ceiling breaches.
```{r Model05A_Intl}

#Frequency Plot
summary_discrete_plot(def_breach,"Intl",metric="cbre")



#Create the model
ln_CBre_05A <- glm(data=def_breach,
  ln_CBre_Then_Year ~b_Intl
)
summary(ln_CBre_05A)



stargazer::stargazer(ln_CBre_05A,ln_CBre_Cons_04C,
                       ln_CBre_Comp_04C,type="text",
                       digits=2)


#For first model in category, include only the new model(s), skip_vif=true
summary_residual_compare(ln_CBre_05A,bins=2,skip_vif = TRUE)

```

International performance of contract had a positive  coefficent as expected.

###Model 05B: Cumulative

```{r Model05B_Comp}

#Create the model
ln_CBre_Cons_05B <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl)
glmer_examine(ln_CBre_Cons_05B)

ln_CBre_Comp_05B <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+
                   cl_def6_ratio_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl)
glmer_examine(ln_CBre_Comp_05B)




stargazer::stargazer(ln_CBre_05A,ln_CBre_Cons_04C,ln_CBre_Cons_05B,
                       ln_CBre_Comp_04C,ln_CBre_Comp_05B,type="text",
                       digits=2)

#ompare with cumulative consolidation and competition
summary_residual_compare(ln_CBre_Cons_04C,ln_CBre_Cons_05B,ln_CBre_Comp_04C,ln_CBre_Comp_05B,bins=20,skip_vif = FALSE)

# if(exists("ln_CBre_04A")) rm(ln_CBre_04A)

```
Increase in magnitude of international's coefficient for both models when incorporated into the cumulative model. Residuals continue to look  odd for those rare very low fitted value contracts, but otherwise seem evenly distributed.

###Model 05C: Reintroduce Defense Obligations

```{r Model05_Comp}

#Create the model
ln_CBre_Cons_05C <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl)
glmer_examine(ln_CBre_Cons_05C)

ln_CBre_Comp_05C <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+
                   cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl)
glmer_examine(ln_CBre_Comp_05C)




stargazer::stargazer(ln_CBre_Cons_05B,ln_CBre_Cons_05C,
                       ln_CBre_Comp_05B,ln_CBre_Comp_05C,type="text",
                       digits=2)

#ompare with cumulative consolidation and competition
summary_residual_compare(ln_CBre_Cons_05B,ln_CBre_Cons_05C,ln_CBre_Comp_05B,ln_CBre_Comp_05C,bins=20,skip_vif = FALSE)
  

```
It does appear that defense obligations can be safely re-added. The direction is still unexpected, but the VIF remains no higher than 1.5 or so, apparently the other new variables introduced did not cause it to creep up further. Like wise the AIC shows some improvement from the addition of the variable. Since defense obligations were included in the binay ceiling breach model, it's preferable  to have it in here as well. Defense ratio 6 loses significance in the competition model as do multiple award IDCs, but in both cases the coefficient was already quite low.
## Competition and Consolidation together
### Model 09A: Combination
```{r Model09A}


#Sumamry plot

ln_CBre_Cons_Comp_09A <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl)
glmer_examine(ln_CBre_Cons_Comp_09A)



stargazer::stargazer(ln_CBre_Cons_05C,
                       ln_CBre_Comp_05C,ln_CBre_Cons_Comp_09A,type="text",
                       digits=2)

#Compare with cumulative consolidation and competition
summary_residual_compare(ln_CBre_Cons_05C,ln_CBre_Cons_Comp_09A,ln_CBre_Comp_05C,ln_CBre_Cons_Comp_09A,bins=20,skip_vif = TRUE)


if(exists("ln_CBre_05A")) rm(ln_CBre_05A)
```
There is no real hange in the study variables. 



In two cases  controls that were significant in only one of the two models, other fixed price, multi-award IDCs,, lost signiciance. def 3 HHI gained significance at the 0.1 level. def6 Ratio  rerained signicance despite lacking it in the competition model.


## Interactions

### Interactions with Study Variables

#### Model 10A: Comp:UCA
Starting with Competition and UCA. It's strong in both models and thus a natural starting point. Competition is expected to mitigate the risks of UCA.
```{r Model10A}
#Sumamry plot
summary_discrete_plot(def_breach,"CompOffr","UCA",metric="cbre")


#Create the model
ln_CBre_Comp_10A_no_interact <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+b_UCA)
glmer_examine(ln_CBre_Comp_10A_no_interact)



ln_CBre_Comp_10A <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+b_UCA+
                        b_UCA:CompOffr)
glmer_examine(ln_CBre_Comp_10A)


stargazer::stargazer(ln_CBre_Comp_01A,ln_CBre_04B,
                       ln_CBre_Comp_10A_no_interact,ln_CBre_Comp_10A,type="text",
                       digits=2)

  

summary_residual_compare(ln_CBre_Comp_10A_no_interact,ln_CBre_Comp_10A,bins=5)


```
The results are contrary and csuse UCA to lose significance.  That said, it is included in the ceiling breach model, so let's check out its inclusion.


#### Model 10B: Cumulative
Starting with Competition and UCA. It's strong in both models and thus a natural starting point.
```{r Model10B}

#Create the model
ln_CBre_Comp_10B <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+
                   cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr)
glmer_examine(ln_CBre_Comp_10B)



ln_CBre_Cons_Comp_10B <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr )
glmer_examine(ln_CBre_Cons_Comp_10B)



stargazer::stargazer(ln_CBre_04B,
                       ln_CBre_Comp_10A_no_interact,ln_CBre_Comp_10A,
                     ln_CBre_Comp_05C,ln_CBre_Comp_10B,ln_CBre_Cons_Comp_09A,ln_CBre_Cons_Comp_10B,type="text",
                       digits=2)


summary_residual_compare(ln_CBre_Comp_05C,ln_CBre_Comp_10B,ln_CBre_Cons_Comp_09A,ln_CBre_Cons_Comp_10B,bins=50)


```
The interaction is significant and multi-offer competion w/ 2 or 5+ offers estimates lower risks associated with UCAs. Surprisingly, this goes in the opposite direction as the terms alone.

In diagnostic terms, the residuals for ceiling breaches get a little worse, but the change is marginal and the interaction is relevant to study questions. Keeping it.

Current cumulative model: ln_CBre_Cons_05C, ln_CBre_Comp_10B. ln_CBre_Cons_Comp_10B

#### Model 10C: Cons:UCA
Next Consolidation and UCA. Testing at both levels. Right now both are negative, but in both cases the expectation  is a more consolidated market is riskier for UCA.
```{r Model10C}
#Sumamry plot
summary_continuous_plot(def_breach,"cl_def6_HHI_lag1","UCA",metric="cbre")



#Create the model
ln_CBre_Cons_10C_NCS6_no_interact <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+b_UCA)
glmer_examine(ln_CBre_Cons_10C_NCS6_no_interact)

ln_CBre_Cons_10C_NCS6 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+b_UCA+
                        b_UCA:cl_def6_HHI_lag1 )
glmer_examine(ln_CBre_Cons_10C_NCS6)

ln_CBre_Cons_10C_NCS3_no_interact <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def3_HHI_lag1+b_UCA )
glmer_examine(ln_CBre_Cons_10C_NCS3_no_interact)


ln_CBre_Cons_10C_NCS3 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def3_HHI_lag1+b_UCA+
                        b_UCA:cl_def3_HHI_lag1 )
glmer_examine(ln_CBre_Cons_10C_NCS3)


stargazer::stargazer(ln_CBre_04B,ln_CBre_Cons_10C_NCS6_no_interact,
                     ln_CBre_Cons_10C_NCS6,ln_CBre_Cons_10C_NCS3_no_interact,ln_CBre_Cons_10C_NCS3,type="text",
                       digits=2)

  

summary_residual_compare(ln_CBre_Cons_10C_NCS6_no_interact,ln_CBre_Cons_10C_NCS6,
                         ln_CBre_Cons_10C_NCS3_no_interact,ln_CBre_Cons_10C_NCS3,bins=20)


```
Expectations hold. Both improve the AIC, the jump for HHI6 is larger than for HHi3

#### Model 10D: Cumulative
```{r Model10D}

#Create the model
ln_CBre_Cons_10D_NCS6 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:cl_def6_HHI_lag1 )
glmer_examine(ln_CBre_Cons_10D_NCS6)

ln_CBre_Cons_10D_NCS3 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:cl_def3_HHI_lag1 )
glmer_examine(ln_CBre_Cons_10D_NCS3)


ln_CBre_Cons_Comp_10D_NCS6 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr+b_UCA:cl_def6_HHI_lag1 )
glmer_examine(ln_CBre_Cons_Comp_10D_NCS6)


ln_CBre_Cons_Comp_10D_NCS3 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr+b_UCA:cl_def3_HHI_lag1 )
glmer_examine(ln_CBre_Cons_Comp_10D_NCS3)




stargazer::stargazer(ln_CBre_Cons_10C_NCS6,ln_CBre_Cons_10C_NCS3,
                     ln_CBre_Cons_05C,
                     ln_CBre_Cons_10D_NCS6,ln_CBre_Cons_10D_NCS3,type="text",
                       digits=2)

stargazer::stargazer(ln_CBre_Cons_Comp_10B,
                     ln_CBre_Cons_Comp_10D_NCS6,
                     ln_CBre_Cons_Comp_10D_NCS3,type="text",
                       digits=2)


summary_residual_compare(ln_CBre_Cons_05C,ln_CBre_Cons_10D_NCS3,
                         ln_CBre_Cons_05C,ln_CBre_Cons_10D_NCS6,bins=50)

summary_residual_compare(ln_CBre_Cons_Comp_10B,ln_CBre_Cons_Comp_10D_NCS3,
                         ln_CBre_Cons_Comp_10B,ln_CBre_Cons_Comp_10D_NCS6,bins=50)


```
NAICS6 Adds a bit to the model and doesn't make the residuals worse. Going with the NAICS 6 version as NAICS3 is starting from anot significant baseline and NAICS3 doesn't help AIC.

Current cumulative model: ln_CBre_Cons_10D_NCS6, ln_CBre_Comp_10B. ln_CBre_Cons_Comp_10D_NCS6



#### Model 10E: Comp:Days
The next reintroduction is competition and days. The benefits of competition may reduce over time. We don't have firm expectations for consolidation, so leaving that out.
```{r Model10E}


#Sumamry plot
summary_continuous_plot(def_breach,"cl_Days","EffComp",metric="cbre")



ln_CBre_Comp_10E_no_interact <- glm (data=def_breach,
                      ln_CBre_Then_Year~CompOffr+ cl_Days
                      )
glmer_examine(ln_CBre_Comp_10E_no_interact)


ln_CBre_Comp_10E <- glm (data=def_breach,
                      ln_CBre_Then_Year~CompOffr+ cl_Days+
                        cl_Days:CompOffr
                      )
glmer_examine(ln_CBre_Comp_10E)

ln_CBre_Cons_Comp_10E <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr+b_UCA:cl_def6_HHI_lag1+
                   cl_Days:CompOffr)
glmer_examine(ln_CBre_Cons_Comp_10E)

```

This combination encounters VIF problems for competition Leaving it out.

#### Model 10F: Comp:Ceiling
The next reintroduction is competition and size. Large contracts may inspire aggressive biddng, which may in turn lead to cost growth as true costs are discovered. We don't have firm expectations for consolidation, so leaving that out.
```{r Model10F}


#Sumamry plot
summary_continuous_plot(def_breach,"cl_Ceil_Then_Year","EffComp",metric="cbre")



ln_CBre_Comp_10F_no_interact <- glm (data=def_breach,
                      ln_CBre_Then_Year~CompOffr+ cl_Ceil_Then_Year
                      )
glmer_examine(ln_CBre_Comp_10F_no_interact)


ln_CBre_Comp_10F <- glm (data=def_breach,
                      ln_CBre_Then_Year~CompOffr+ cl_Ceil_Then_Year+
                        cl_Ceil_Then_Year:CompOffr
                      )
glmer_examine(ln_CBre_Comp_10F)


ln_CBre_Cons_Comp_10F <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr+b_UCA:cl_def6_HHI_lag1+
                   cl_Ceil_Then_Year:CompOffr)
glmer_examine(ln_CBre_Cons_Comp_10F)
```
VIF challenges. Leaving out.

#### Model 10G: Comp:Veh
Competition works differently for single award vehicles, it represents  the initial competition, not the ongoing competition. As a result, single-award IDCs and BPA/BOAs are expected to be associated with more growth, than for other contracting forms where contracting occurs with every iteration.
```{r Model10G}


#Sumamry plot
summary_continuous_plot(def_breach,"cl_Ceil_Then_Year","EffComp",metric="cbre")



ln_CBre_Comp_10G_no_interact <- glm (data=def_breach,
                      ln_CBre_Then_Year~CompOffr+ Veh
                      )
glmer_examine(ln_CBre_Comp_10G_no_interact)


ln_CBre_Comp_10G <- glm (data=def_breach,
                      ln_CBre_Then_Year~CompOffr+ Veh+
                        Veh:CompOffr
                      )
glmer_examine(ln_CBre_Comp_10G)


#Create the model
ln_CBre_Comp_10G <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+
                   cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr+
                   CompOffr:Veh)
glmer_examine(ln_CBre_Comp_10G)


```
Excluded for VIF reasons. There's a lot of combinations, which makes it a bit tricky to include and probably helps drive up the VIF (2.2 even w/ only two variables.

#### Model 10H: Def Sec Obl:HHI
Because HHI in smaller sectors tends to be larger, high readings from large sectors may deserve more weight. This interaction is expected to amplify HHI magnitudes. This is most relevant for detailed sectors, which are highly variable in size.
```{r Model10H}


#Sumamry plot
summary_double_continuous(def_breach,"cl_def6_obl_lag1","cl_def6_HHI_lag1")#,metric="cbre"


#Create the model


ln_CBre_Cons_10H_no_interact <- glm (data=def_breach,
                      ln_CBre_Then_Year ~
                        cl_def6_HHI_lag1+cl_def6_obl_lag1 
                      )
glmer_examine(ln_CBre_Cons_10H_no_interact)


ln_CBre_Cons_10H<- glm (data=def_breach,
                      ln_CBre_Then_Year ~
                        cl_def6_HHI_lag1+cl_def6_obl_lag1+
                        cl_def6_HHI_lag1:cl_def6_obl_lag1  
                      )
glmer_examine(ln_CBre_Cons_10H)


  stargazer::stargazer(ln_CBre_Cons_NCS6A,ln_CBre_NCS6C,
    ln_CBre_Cons_10H_no_interact,ln_CBre_Cons_10H,type="text",
                       digits=2)
  
  

summary_residual_compare(ln_CBre_Cons_10H_no_interact,ln_CBre_Cons_10H,bins=20)


```
Results are significant and in line with expectations as they amplify th negative magnitude of HHI. That said defense obligations remains contrary to expectations.

#### Model 10I: Cumulative
```{r Model10I}

#Create the model
ln_CBre_Cons_10I <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:cl_def6_HHI_lag1+
                    cl_def6_HHI_lag1:cl_def6_obl_lag1  
                   )
glmer_examine(ln_CBre_Cons_10I)


ln_CBre_Cons_Comp_10I <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr+b_UCA:cl_def6_HHI_lag1 +
                    cl_def6_HHI_lag1:cl_def6_obl_lag1  )
glmer_examine(ln_CBre_Cons_Comp_10I)




stargazer::stargazer(ln_CBre_Cons_10D_NCS6,ln_CBre_Cons_10I,
                         ln_CBre_Cons_Comp_10D_NCS6,ln_CBre_Cons_Comp_10I,type="text",
                       digits=2)

  


summary_residual_compare(ln_CBre_Cons_10D_NCS6,ln_CBre_Cons_10I,
                         ln_CBre_Cons_Comp_10D_NCS6,ln_CBre_Cons_Comp_10I,bins=20)

```
The interaction goes against expectation, is only significant at the 0.1 level, and has a minimal change in AIC (<2 in both cases). Leaving out. 


Current cumulative model: ln_CBre_Cons_10D_NCS6, ln_CBre_Comp_10B. ln_CBre_Cons_Comp_10D_NCS6



#### Model 10J: Ratio:HHI
Primarily, if the defense sector is a large proportion of the commercial economy, then consolidation would presumably  matter more because new commercial players aren't available as alternative.  This interaction is expected to have a positive sign, even if HHI  is negative.

```{r Model10J}


#Sumamry plot
summary_double_continuous(def_breach,"cl_def6_ratio_lag1","cl_def6_HHI_lag1")#,metric="cbre"
summary_double_continuous(def_breach,"cl_def3_ratio_lag1","cl_def3_HHI_lag1")#,metric="cbre"

#Create the model
ln_CBre_Cons_10J_NCS6_no_interact <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1)
glmer_examine(ln_CBre_Cons_10J_NCS6_no_interact)

ln_CBre_Cons_10J_NCS6 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+
                        cl_def6_ratio_lag1:cl_def6_HHI_lag1 )
glmer_examine(ln_CBre_Cons_10J_NCS6)

ln_CBre_Cons_10J_NCS3_no_interact <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def3_HHI_lag1+cl_def3_ratio_lag1 )
glmer_examine(ln_CBre_Cons_10J_NCS3_no_interact)


ln_CBre_Cons_10J_NCS3 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                        cl_def3_ratio_lag1:cl_def3_HHI_lag1 )
glmer_examine(ln_CBre_Cons_10J_NCS3)


  stargazer::stargazer(ln_CBre_Cons_10J_NCS6_no_interact,ln_CBre_Cons_10J_NCS6,
                       ln_CBre_Cons_10J_NCS3_no_interact,ln_CBre_Cons_10J_NCS3,type="text",
                       digits=2)
  
  

summary_residual_compare(ln_CBre_Cons_10J_NCS6_no_interact,ln_CBre_Cons_10J_NCS6,
                       ln_CBre_Cons_10J_NCS3_no_interact,ln_CBre_Cons_10J_NCS3,bins=20)



```
Significant but contrary to expectations in both cases, though with larger reductions in AIC.

#### Model 10K: Cumulative
```{r Model10K}
#Create the model
ln_CBre_Cons_10K_NCS6 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:cl_def6_HHI_lag1+
                   cl_def6_ratio_lag1:cl_def6_HHI_lag1)
glmer_examine(ln_CBre_Cons_10K_NCS6)

ln_CBre_Cons_10K_NCS3 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:cl_def6_HHI_lag1 +
                   cl_def3_ratio_lag1:cl_def3_HHI_lag1 )
glmer_examine(ln_CBre_Cons_10K_NCS3)


ln_CBre_Cons_Comp_10K_NCS6 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr+b_UCA:cl_def6_HHI_lag1+
                   cl_def6_ratio_lag1:cl_def6_HHI_lag1)
glmer_examine(ln_CBre_Cons_Comp_10K_NCS6)


ln_CBre_Cons_Comp_10K_NCS3 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr+b_UCA:cl_def6_HHI_lag1 +
                   cl_def3_ratio_lag1:cl_def3_HHI_lag1 )
glmer_examine(ln_CBre_Cons_Comp_10K_NCS3)




stargazer::stargazer(ln_CBre_Cons_10D_NCS6,
                     ln_CBre_Cons_10K_NCS3,ln_CBre_Cons_10K_NCS6,
                     ln_CBre_Cons_Comp_10D_NCS6,
                     ln_CBre_Cons_Comp_10K_NCS3,ln_CBre_Cons_Comp_10K_NCS6,
                     type="text",
                       digits=2)


summary_residual_compare(ln_CBre_Cons_10D_NCS6,ln_CBre_Cons_10K_NCS3,
                         ln_CBre_Cons_10D_NCS6,ln_CBre_Cons_10K_NCS6,bins=50)

summary_residual_compare(ln_CBre_Cons_Comp_10D_NCS6,ln_CBre_Cons_Comp_10K_NCS3,
                         ln_CBre_Cons_Comp_10D_NCS6,ln_CBre_Cons_Comp_10K_NCS6,bins=50)


```
Both AICs are reduced, with the greater reduction from NAICS3 boosted. NAICS3 is strengthened  and achieves significance  but only  for  the comp and cons model, NAICS6 is just strengthened slightly. However in both cases contrary to expectation. Leaving out as contrary to expectations and NAICS3 lacks significance which is desirable in a component.

Current cumulative model: ln_CBre_Cons_10D_NCS6, ln_CBre_Comp_10B. ln_CBre_Cons_Comp_10D_NCS6


#### Model 10L: Ratio:Comp
Likewise, competition may be more effective in more commercial sectors where monosopy is not a problem.
```{r Model10L}
summary_continuous_plot(def_breach,"cl_def6_ratio_lag1","EffComp",metric="cbre")
summary_continuous_plot(def_breach,"cl_def3_ratio_lag1","EffComp",metric="cbre")

ln_CBre_Comp_10L_NCS3_no_interact <- glm (data=def_breach,
                      ln_CBre_Then_Year ~
                        cl_def3_ratio_lag1+
                        CompOffr
                      )
glmer_examine(ln_CBre_Comp_10L_NCS3_no_interact)



ln_CBre_Comp_10L_NCS3 <- glm (data=def_breach,
                      ln_CBre_Then_Year ~
                        cl_def3_ratio_lag1+
                        CompOffr+
                        cl_def3_ratio_lag1:CompOffr
                      )
glmer_examine(ln_CBre_Comp_10L_NCS3)


ln_CBre_Comp_10L_NCS3_full <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+
                   cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr+
                   cl_def3_ratio_lag1:CompOffr)
glmer_examine(ln_CBre_Comp_10L_NCS3_full)


ln_CBre_Comp_10L_NCS6_no_interact <- glm (data=def_breach,
                      ln_CBre_Then_Year ~
                        cl_def6_ratio_lag1+cl_def6_obl_lag1+
                        CompOffr
                      )
glmer_examine(ln_CBre_Comp_10L_NCS6_no_interact)



ln_CBre_Comp_10L_NCS6 <- glm (data=def_breach,
                      ln_CBre_Then_Year ~
                        cl_def6_ratio_lag1+cl_def6_obl_lag1+
                        CompOffr+
                        cl_def6_ratio_lag1:CompOffr
                      )
glmer_examine(ln_CBre_Comp_10L_NCS6)

ln_CBre_Comp_10L_NCS6_full <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+
                   cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr+
                   cl_def6_ratio_lag1:CompOffr)
glmer_examine(ln_CBre_Comp_10L_NCS6_full)




  stargazer::stargazer(ln_CBre_Comp_10L_NCS3_no_interact,ln_CBre_Comp_10L_NCS3,type="text",
                       digits=2)



# summary_residual_compare(ln_CBre_Comp_10L_NCS3_no_interact,ln_CBre_Comp_10L_NCS3,bins=10)

```
Significant but contrary to exxpectations for competition with 3-4 and 5+ multiple offers. VIF is exceed for Def6 and close for Def3 at 1.98 in full model. Leaving out.

#### Model 10M: HHI6 and competition
If competition is an instrument for consolidation, than it should be most effective when consolidation is lower.
```{r Model10M}


#Create the model
ln_CBre_Cons_Comp_10M_NCS6_no_interact <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+CompOffr)
glmer_examine(ln_CBre_Cons_Comp_10M_NCS6_no_interact)

ln_CBre_Cons_Comp_10M_NCS6 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+CompOffr+
                        CompOffr:cl_def6_HHI_lag1 )
glmer_examine(ln_CBre_Cons_Comp_10M_NCS6)

ln_CBre_Cons_Comp_10M_NCS3_no_interact <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def3_HHI_lag1+CompOffr )
glmer_examine(ln_CBre_Cons_Comp_10M_NCS3_no_interact)


ln_CBre_Cons_Comp_10M_NCS3 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def3_HHI_lag1+CompOffr+
                        CompOffr:cl_def3_HHI_lag1 )
glmer_examine(ln_CBre_Cons_Comp_10M_NCS3)




```
The interaction ran into VIF challenges. Leaving it out.


### Other Interactions

#### Model 11A: UCA and Ceiling
Larger ceiling UCAs may run into bigger problems. The interaction of UCA and ceiling estimates a higher risk of breaches. 

```{r Model11A}


#Sumamry plot
summary_continuous_plot(def_breach,"cl_Ceil_Then_Year","UCA",metric="cbre")

#Create the model


ln_CBre_11A_no_interact <- glm (data=def_breach,
                      ln_CBre_Then_Year ~cl_Ceil_Then_Year + b_UCA
                      )
glmer_examine(ln_CBre_11A_no_interact)


ln_CBre_11A <- glm (data=def_breach,
                      ln_CBre_Then_Year ~cl_Ceil_Then_Year + b_UCA+
                        b_UCA:cl_Ceil_Then_Year
                      )
glmer_examine(ln_CBre_11A)



  stargazer::stargazer(ln_CBre_02A,ln_CBre_04B,ln_CBre_11A_no_interact,ln_CBre_11A,type="text",
                       digits=2)
  
  

summary_residual_compare(ln_CBre_11A_no_interact,ln_CBre_11A,bins=5)


```
The result runs contrary to expectation and only slightly reduces AIC and is largely a wash when it comes to residuals. One possible rationale is that small UCAs may raise risks because they are under less scrutiny.

#### Model 11B: Cumulative
```{r Model11B}

#Create the model
ln_CBre_Cons_11B <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:cl_def6_HHI_lag1+
                        b_UCA:cl_Ceil_Then_Year)
glmer_examine(ln_CBre_Cons_11B)


ln_CBre_Comp_11B <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+
                   cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr+
                        b_UCA:cl_Ceil_Then_Year)
glmer_examine(ln_CBre_Comp_10B)



ln_CBre_Cons_Comp_11B <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr+b_UCA:cl_def6_HHI_lag1+
                        b_UCA:cl_Ceil_Then_Year)
glmer_examine(ln_CBre_Cons_Comp_11B)





  
  
  stargazer::stargazer(ln_CBre_Comp_10B,ln_CBre_Comp_11B,
                       ln_CBre_Cons_10D_NCS6,ln_CBre_Cons_11B,
                       ln_CBre_Cons_Comp_10D_NCS6,ln_CBre_Cons_Comp_11B,type="text",
                         digits=2)

summary_residual_compare(ln_CBre_Cons_10K_NCS6,ln_CBre_Cons_11B,
                         ln_CBre_Comp_10B,ln_CBre_Comp_11B,bins=20)


summary_residual_compare(ln_CBre_Cons_Comp_10K_NCS6,ln_CBre_Cons_Comp_11B,bins=50)


```
Current cumulative model: ln_CBre_Cons_10D_NCS3, ln_CBre_Comp_10B. ln_CBre_Cons_Comp_10D_NCS6. AIC reduction of  about 20 points. Contrary to expectations. Leaving  out.

#### Model 11C: UCA and Duration
UCA is sometimes used for contracts that need to be executed fast and may be short. Definitizing a contract is a form of change order, though not one that  necessarily leads to a ceiling breach. Thus the slope for UCAs across duration may be gentler than it is for non-UCA contracts. (Although on the other hands, regulatorry attempts to limit the duration  of UCA contracts would suggest higher risk for  longerones)

```{r Model11C}


#Sumamry plot
summary_continuous_plot(def_breach,"cl_Days","UCA",metric="cbre")

#Create the model
ln_CBre_11C_no_interact <- glm (data=def_breach,
                      ln_CBre_Then_Year ~cl_Days + b_UCA
                      )
glmer_examine(ln_CBre_11C_no_interact)


ln_CBre_11C <- glm (data=def_breach,
                      ln_CBre_Then_Year ~cl_Days + b_UCA+
                        b_UCA:cl_Days
                      )
glmer_examine(ln_CBre_11C)



  stargazer::stargazer(ln_CBre_02B,ln_CBre_04B,ln_CBre_11C_no_interact,ln_CBre_11C,type="text",
                       digits=2)
  
  

summary_residual_compare(ln_CBre_11C_no_interact,ln_CBre_11C,bins=5)


```
The direction is as expected and highmagnitude, though does little to reduce  the AIC.

#### Model 11D: Cumulative
```{r Model11D}
#Create the model


ln_CBre_Comp_11D <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+
                   cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr+
                        b_UCA:cl_Days)
glmer_examine(ln_CBre_Comp_11D)


ln_CBre_Comp_11D2 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+
                   cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        # b_UCA:CompOffr+
                        b_UCA:cl_Days)
glmer_examine(ln_CBre_Comp_11D2)



ln_CBre_Cons_Comp_11D <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr+b_UCA:cl_def6_HHI_lag1+
                        b_UCA:cl_Days)
glmer_examine(ln_CBre_Cons_Comp_11D)


ln_CBre_Cons_Comp_11D2 <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        # b_UCA:CompOffr+
                   b_UCA:cl_def6_HHI_lag1+
                        b_UCA:cl_Days)
glmer_examine(ln_CBre_Cons_Comp_11D2)

```

Adding days require removing UCA:Comp and even then borderling. Leaving it out.

#### Model 11E: Pricing and Average Wage

Average wage is a proxy for unobserved skill requirements, which in turn is a proxy for complexity. Fixed price contracting may run afoul of in these sectors, due to the greater difficulties of prediction. Labor hours/t&M, will likely are expected to estimate lower risk of problems, but not as low as cost-based. Incentive fee and cost-based are both expected to lower the estimated risk fo breaches.

```{r Model11E}


#Sumamry plot
summary_continuous_plot(def_breach,"cl_US6_avg_sal_lag1","PricingFee",metric="cbre",log=TRUE)


#Create the model
ln_CBre_NCS11E_no_interact <- glm (data=def_breach,
                      ln_CBre_Then_Year ~cl_US6_avg_sal_lag1 + PricingFee
                      )
glmer_examine(ln_CBre_NCS6D_no_interact)

ln_CBre_NCS11E <- glm (data=def_breach,
                      ln_CBre_Then_Year ~cl_US6_avg_sal_lag1 + PricingFee+
                        cl_US6_avg_sal_lag1:PricingFee
                      )
glmer_examine(ln_CBre_NCS11E)


  stargazer::stargazer(ln_CBre_NCS6D,ln_CBre_04A,ln_CBre_NCS6D_no_interact,ln_CBre_NCS6D,type="text",
                       digits=2)
  
  

summary_residual_compare(ln_CBre_NCS11E_no_interact,ln_CBre_NCS11E,bins=10)


```
The results are as expected and significant.


#### Model 11F: Cumulative
```{r Model11F}
#Create the model


ln_CBre_Cons_11F <- glm (data=def_breach,
                 ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:cl_def6_HHI_lag1+
                        cl_US6_avg_sal_lag1:PricingFee)
glmer_examine(ln_CBre_Cons_11F)


ln_CBre_Comp_11F <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+
                   cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr+
                        cl_US6_avg_sal_lag1:PricingFee)
glmer_examine(ln_CBre_Comp_11F)



ln_CBre_Cons_Comp_11F <- glm (data=def_breach,
                 ln_CBre_Then_Year ~CompOffr+cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                   cl_Ceil_Then_Year+ cl_Days+
                   Veh+
                   PricingFee+b_UCA+
                   b_Intl +
                        b_UCA:CompOffr+b_UCA:cl_def6_HHI_lag1+
                        cl_US6_avg_sal_lag1:PricingFee)
glmer_examine(ln_CBre_Cons_Comp_11F)

stargazer::stargazer(ln_CBre_Comp_10B,ln_CBre_Comp_11F,
                       ln_CBre_Cons_10D_NCS6,ln_CBre_Cons_11F,
                       ln_CBre_Cons_Comp_10D_NCS6,ln_CBre_Cons_Comp_11F,type="text",
                         digits=2)


stargazer::stargazer(ln_CBre_Comp_10B,ln_CBre_Comp_11F,
                       ln_CBre_Cons_10D_NCS6,ln_CBre_Cons_11F,
                       ln_CBre_Cons_Comp_10D_NCS6,ln_CBre_Cons_Comp_11F,type="text",
                         digits=2)


summary_residual_compare(ln_CBre_Comp_10B,ln_CBre_Comp_11F,
                       ln_CBre_Cons_10D_NCS6,ln_CBre_Cons_11F,bins=50)


summary_residual_compare(ln_CBre_Cons_Comp_10D_NCS6,ln_CBre_Cons_Comp_11F,bins=50)




```

## Multilevel Model
###Model 15A: Developed Above
First run using the model developed in prior steps.

```{r Model15A}
if(file.exists("..//Output//2019_Models//Archives//ln_CBre_Cons_15A.rdata")) load(file="..//Output//Archives//2019_Models//ln_CBre_15A.rdata")

if(!exists("ln_CBre_Cons_15A"))
  ln_CBre_Cons_15A <- lmer (data=def_breach,
                            ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                              cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                              cl_Ceil_Then_Year+ cl_Days+
                              Veh+
                              PricingFee+b_UCA+
                              b_Intl +
                              b_UCA:cl_def6_HHI_lag1+
                              cl_US6_avg_sal_lag1:PricingFee+
                              (1 | NAICS3/NAICS) + 
                              (1 | Agency/Office),
                            verbose=TRUE)
glmer_examine(ln_CBre_Cons_15A)


if(!exists("ln_CBre_Comp_15A"))
  ln_CBre_Comp_15A <- lmer (data=def_breach,
                            ln_CBre_Then_Year ~CompOffr+
                              cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                              cl_def3_ratio_lag1+
                              cl_Ceil_Then_Year+ cl_Days+
                              Veh+
                              PricingFee+b_UCA+
                              b_Intl +
                              b_UCA:CompOffr+
                              cl_US6_avg_sal_lag1:PricingFee+
                              (1 | NAICS3/NAICS) + 
                              (1 | Agency/Office),
                              verbose=TRUE)
glmer_examine(ln_CBre_Comp_15A)

if(!exists("ln_CBre_Cons_Comp_15A"))
  ln_CBre_Cons_Comp_15A <- lmer (data=def_breach,
                                 ln_CBre_Then_Year ~CompOffr+cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                                   cl_Ceil_Then_Year+ cl_Days+
                                   Veh+
                                   PricingFee+b_UCA+
                                   b_Intl +
                                   b_UCA:CompOffr+
                                   b_UCA:cl_def6_HHI_lag1+
                                   cl_US6_avg_sal_lag1:PricingFee+
                                   (1 | NAICS3/NAICS) + 
                                   (1 | Agency/Office),
                                 verbose=TRUE)
glmer_examine(ln_CBre_Cons_Comp_15A)



stargazer::stargazer(ln_CBre_Comp_11F,ln_CBre_Comp_15A,
                       ln_CBre_Cons_11F,ln_CBre_Cons_15A,
                       ln_CBre_Cons_Comp_11F,ln_CBre_Cons_Comp_15A,type="text",
                         digits=2)


summary_residual_compare(ln_CBre_Comp_11F,ln_CBre_Comp_15A,
                       ln_CBre_Cons_11F,ln_CBre_Cons_15A,bins=50)

texreg::htmlreg(list(ln_CBre_Cons_15A,ln_CBre_Comp_15A,ln_CBre_Cons_Comp_15A),file="..//Output//Breach_Contract_Model.html",
                single.row = TRUE)


summary_residual_compare(ln_CBre_Cons_Comp_11F,ln_CBre_Cons_Comp_15A,bins=50)

save(ln_CBre_Cons_15A,ln_CBre_Comp_15A,ln_CBre_Cons_Comp_15A,file="..//Output//2019_Models//ln_CBre_15A.rdata")
```



### Model 15B: Logit Match
Second model, exactly matching the model used in ceiling breach logit.

```{r Model15B}
if(file.exists("..//Output//ln_CBre_Cons_15B.rdata")) load(file="..//Output//ln_CBre_Cons_15B.rdata")

if(!exists("ln_CBre_Cons_15B"))
  ln_CBre_Cons_15B <- lmer (data=def_breach,
                            ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                              cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                              cl_Ceil_Then_Year+ cl_Days+
                              Veh+
                              PricingFee+b_UCA+
                              b_Intl +
                              b_UCA:cl_def6_HHI_lag1+
                              b_UCA:cl_Ceil_Then_Year+
                              cl_def6_HHI_lag1:cl_def6_obl_lag1+
                              (1 | NAICS3/NAICS) + 
                              (1 | Agency/Office),
                            verbose=TRUE)
glmer_examine(ln_CBre_Cons_15B)


if(!exists("ln_CBre_Comp_15B"))
  ln_CBre_Comp_15B <- lmer (data=def_breach,
                            ln_CBre_Then_Year ~CompOffr+
                              cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                              cl_def3_ratio_lag1+
                              cl_Ceil_Then_Year+ cl_Days+
                              Veh+
                              PricingFee+b_UCA+
                              b_Intl +
                              b_UCA:CompOffr+
                              b_UCA:cl_Ceil_Then_Year+
                              (1 | NAICS3/NAICS) + 
                              (1 | Agency/Office),
                              verbose=TRUE)
glmer_examine(ln_CBre_Comp_15B)

if(!exists("ln_CBre_Cons_Comp_15B"))
  ln_CBre_Cons_Comp_15B <- lmer (data=def_breach,
                                 ln_CBre_Then_Year ~CompOffr+cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                                   cl_Ceil_Then_Year+ cl_Days+
                                   Veh+
                                   PricingFee+b_UCA+
                                   b_Intl +
                                   b_UCA:CompOffr+
                                   b_UCA:cl_def6_HHI_lag1+
                                   b_UCA:cl_Ceil_Then_Year+
                                   cl_def6_HHI_lag1:cl_def6_obl_lag1+
                                   (1 | NAICS3/NAICS) + 
                                   (1 | Agency/Office),
                                 verbose=TRUE)
glmer_examine(ln_CBre_Cons_Comp_15B)



stargazer::stargazer(ln_CBre_Comp_15A,ln_CBre_Comp_15A,
                       ln_CBre_Cons_15A,ln_CBre_Cons_15B,
                       ln_CBre_Cons_Comp_15A,ln_CBre_Cons_Comp_155,type="text",
                         digits=2)


summary_residual_compare(ln_CBre_Comp_15A,ln_CBre_Comp_15B,
                       ln_CBre_Cons_15A,ln_CBre_Cons_15B,bins=50)

summary_residual_compare(ln_CBre_Cons_Comp_15A,ln_CBre_Cons_Comp_155,bins=50)

save(ln_CBre_Cons_15B,ln_CBre_Comp_15B,ln_CBre_Cons_Comp_15B,
     file="..//Output//ln_CBre_15B.rdata")
```

###Model 15C: Rerun after UCA, ratio, and construction fixes
First run using the model developed in prior steps.

```{r Model15C}
if(file.exists("..//Output//ln_CBre_Cons_15C.rdata")) load(file="..//Output//ln_CBre_Cons_15C.rdata")

if(!exists("ln_CBre_Cons_15C"))
  ln_CBre_Cons_15C <- lmer (data=def_breach,
                            ln_CBre_Then_Year ~cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                              cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                              cl_Ceil_Then_Year+ cl_Days+
                              Veh+
                              PricingFee+b_UCA+
                              b_Intl +
                              b_UCA:cl_def6_HHI_lag1+
                              cl_US6_avg_sal_lag1:PricingFee+
                              (1 | NAICS3/NAICS) + 
                              (1 | Agency/Office),
                            verbose=TRUE)
glmer_examine(ln_CBre_Cons_15C)


if(!exists("ln_CBre_Comp_15C"))
  ln_CBre_Comp_15C <- lmer (data=def_breach,
                            ln_CBre_Then_Year ~CompOffr+
                              cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                              cl_def3_ratio_lag1+
                              cl_Ceil_Then_Year+ cl_Days+
                              Veh+
                              PricingFee+b_UCA+
                              b_Intl +
                              b_UCA:CompOffr+
                              cl_US6_avg_sal_lag1:PricingFee+
                              (1 | NAICS3/NAICS) + 
                              (1 | Agency/Office),
                              verbose=TRUE)
glmer_examine(ln_CBre_Comp_15C)

if(!exists("ln_CBre_Cons_Comp_15C"))
  ln_CBre_Cons_Comp_15C <- lmer (data=def_breach,
                                 ln_CBre_Then_Year ~CompOffr+cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                                   cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                                   cl_Ceil_Then_Year+ cl_Days+
                                   Veh+
                                   PricingFee+b_UCA+
                                   b_Intl +
                                   b_UCA:CompOffr+
                                   b_UCA:cl_def6_HHI_lag1+
                                   cl_US6_avg_sal_lag1:PricingFee+
                                   (1 | NAICS3/NAICS) + 
                                   (1 | Agency/Office),
                                 verbose=TRUE)
glmer_examine(ln_CBre_Cons_Comp_15C)



stargazer::stargazer(ln_CBre_Comp_11F,ln_CBre_Comp_15A,ln_CBre_Comp_15C,
                       ln_CBre_Cons_11F,ln_CBre_Cons_15A,ln_CBre_Cons_15C,
                       ln_CBre_Cons_Comp_11F,ln_CBre_Cons_Comp_15A,ln_CBre_Cons_Comp_15C,type="text",
                         digits=2)


summary_residual_compare(ln_CBre_Comp_11F,ln_CBre_Comp_15C,
                       ln_CBre_Cons_11F,ln_CBre_Cons_15C,bins=50)

summary_residual_compare(ln_CBre_Cons_Comp_11F,ln_CBre_Cons_Comp_15C,bins=50)



summary_residual_compare(ln_CBre_Comp_15A,ln_CBre_Comp_15C,
                       ln_CBre_Cons_15A,ln_CBre_Cons_15C,bins=50)

summary_residual_compare(ln_CBre_Cons_Comp_15A,ln_CBre_Cons_Comp_15C,bins=50)

save(ln_CBre_Cons_15C,ln_CBre_Comp_15C,ln_CBre_Cons_Comp_15C,file="..//Output//ln_CBre_15C.rdata")
```