---
title: "Footing"
author: "Greg Sanders"
date: "July 16, 2018"
output: html_document
---
## Setup
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(csis360)
```



```{r import}




load(file = file.path("../Cleaning Data/FPDS/FPDS_datapull_all_v3.Rda"))
load(file = file.path("../Cleaning Data/FPDS/FPDS_cleaned_unique_wtotalobligations.Rda"))

file.exists("Raw Data/FPDS/Vendor.SP_DunsnumberNewEntrants_all.txt")
dir.exists("Cleaning Data/")
dir.exists("Analysis")
file.exists("New Entrants.Rproj")
list.files("../")
FPDS_data <- read.delim(file.path("../Raw Data/FPDS","Vendor.SP_DunsnumberNewEntrants_all.txt"), fill = TRUE, header=TRUE,  na.strings = c("", "NULL"))
FPDS_data<-as.data.frame(FPDS_data)

```


## Prepare the raw data
```{r prepare}

FPDS_data<-csis360::remove_bom(FPDS_data)
# FPDS_data<-subset(FPDS_data,fiscal_year>=2000)
debug(csis360::deflate)
FPDS_data<-csis360::deflate(FPDS_data,money_var="obligatedAmount",
                            fy_var="fiscal_year")
FPDS_data<-FPDS_data %>%
  group_by(Dunsnumber) %>%
  dplyr::mutate(first_year=ifelse(min(fiscal_year)==fiscal_year,TRUE,FALSE) )

FPDS_duns_fyear<-subset(FPDS_data,fiscal_year>=2000) %>%
  group_by(Dunsnumber,fiscal_year,first_year) %>%
  dplyr::summarize(obligatedAmount.2017=sum(obligatedAmount.Deflator.2017,na.rm=TRUE))

FPDS_summary<-FPDS_duns_fyear %>%
  group_by(fiscal_year,first_year) %>%
  dplyr::summarize(obligatedAmount.2017=sum(obligatedAmount.2017,na.rm=TRUE))


```

## Benchmark plots

First lets look at the total number of vendors.

```{r count, echo=FALSE}


build_plot(
  data=FPDS_duns_fyear,
  chart_geom = "Histogram",
  # share = FALSE,
  x_var="fiscal_year",
  # y_var="obligatedAmount.2017", #Name of variable to plot on y-axis
  color_var="first_year",       # name of coloration variable, as string
  # facet_var="first_year",        # name of facet variable, as string
  legend=TRUE, #Include a legend
  caption=TRUE, #Include a source caption
  labels_and_colors=NULL,
  column_key=NULL
)



build_plot(
  data=FPDS_duns_fyear,
  chart_geom = "Histogram",
  # share = FALSE,
  x_var="fiscal_year",
  # y_var="obligatedAmount.2017", #Name of variable to plot on y-axis
  color_var="first_year",       # name of coloration variable, as string
  facet_var="first_year",        # name of facet variable, as string
  legend=TRUE, #Include a legend
  caption=TRUE, #Include a source caption
  labels_and_colors=NULL,
  column_key=NULL
)+facet_wrap(~first_year,scales="free_y",ncol=1)


build_plot(
  data=FPDS_cleaned_unique,
  chart_geom = "Histogram",
  # share = FALSE,
  x_var="FYear",
  # y_var="obligatedAmount.2017", #Name of variable to plot on y-axis
  # color_var="first_year",       # name of coloration variable, as string
  # facet_var="first_year",        # name of facet variable, as string
  legend=TRUE, #Include a legend
  caption=TRUE, #Include a source caption
  labels_and_colors=NULL,
  column_key=NULL
)#+facet_wrap(~first_year,scales="free_y",ncol=1)


```

Then the vendor spend.

```{r dollars}

build_plot(
  data=FPDS_summary,
  chart_geom = "Bar Chart",
  # share = FALSE,
  x_var="fiscal_year",
  y_var="obligatedAmount.2017", #Name of variable to plot on y-axis
  color_var="first_year",       # name of coloration variable, as string
  # facet_var="first_year",        # name of facet variable, as string
  legend=TRUE, #Include a legend
  caption=TRUE, #Include a source caption
  labels_and_colors=NULL,
  column_key=NULL
)

build_plot(
  data=FPDS_summary,
  chart_geom = "Bar Chart",
  # share = FALSE,
  x_var="fiscal_year",
  y_var="obligatedAmount.2017", #Name of variable to plot on y-axis
  color_var="first_year",       # name of coloration variable, as string
  facet_var="first_year",        # name of facet variable, as string
  legend=TRUE, #Include a legend
  caption=TRUE, #Include a source caption
  labels_and_colors=NULL,
  column_key=NULL
)+facet_wrap(~first_year,scales="free_y",ncol=1)

build_plot(
  data=FPDS_cleaned_unique,
  chart_geom = "Bar Chart",
  # share = FALSE,
  x_var="FYear",
  y_var="total_obligations", #Name of variable to plot on y-axis
  # color_var="first_year",       # name of coloration variable, as string
  # facet_var="first_year",        # name of facet variable, as string
  legend=TRUE, #Include a legend
  caption=TRUE, #Include a source caption
  labels_and_colors=NULL,
  column_key=NULL
)#+facet_wrap(~first_year,scales="free_y",ncol=1)


```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
