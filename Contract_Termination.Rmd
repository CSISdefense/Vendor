---
title: "Contract Termination"
author: "Greg Sanders"
date: "Wednesday, February 8, 2017"
output:
  html_document:
    keep_md: yes
--- 

Modeling Likelihood of Contract Termination
============================================================================

#Setup
```{r Libraries, echo = FALSE}
library(csis360)
library(ggplot2)
library(dplyr)
library(arm)
library(R2WinBUGS)
source("DIIGstat.r")

axis.text.size<-10
strip.text.size<-10
legend.text.size<-8
# table.text.size<-5.75
title.text.size<-12
geom.text.size<-12

main.text.size<-1
note.text.size<-1.40


```

Contracts are classified using a mix of numerical and categorical variables. While the changes in numerical variables are easy to grasp and summarize, a contract may have one line item that is competed and another that is not. As is detailed in the exploration on R&D, we are only considering information available prior to contract start. The percentage of contract obligations that were competed is a valuable benchmark, but is highly influenced by factors that occured after contract start..

## Contract Terminations

Contract terminations and the number of change orders can be calculated for the entire sample.  Contract termination is determined using the *Reason for Modification* field in FPDS.  A contract is considered to be terminated if it has at least one modification with the following values:

* "Terminate for Default (complete or partial)"
* "Terminate for Convenience (complete or partial)"
* "Terminate for Cause"
* "Legal Contract Cancellation"

These four catetegories and the "Close Out" category are used to mark a contract as closed.  Many contracts in FPDS and in the sample are never marked closed.  


##Prepare Data
First we load the data. The dataset used is a U.S. Defense Contracting dataset derived from   FPDS.


###Data Transformations
After the data is loaded, we perform a series of transformations, creating derived variables that fit our purposes.

* l_Ceil is the natural log of the initial contract cost ceiling (UnmodifiedContractBaseAndAllOptionsValue).
* l_Days is the natural log of the initial maximum contract duration in days (UnmodifiedDays)
* Changing the unlabeled option for International to NA as it should not be seperately computed.
* b_Term transforms the factor that reports whether a contract was terminated (Term) to a numerical variable, 0 for no terminations, 1 for any partial or complete terminations.
* n_Fixed transforms the factor that reports whether a contract was fixed price or cost-based (FxCB) to a numberical value. 0 for cost-based, 0.5 or "combination or other", 1 for any fixed price (excluding fixed-price level of effort which is classified as cost-based).
* nIncent transforms the factor that reports the fee type (Fee) to a numerical value. 1 for incentive fee or cost sharing, 0.5 or "combination or other", 0 for all remaining types
*  nComp transforms the factor that reports the fee type (cb_Comp) to a numerical value. 1 for Competed, 0 for not competed.
*  n_UCA transforms the factor that reports the use of undefinitized contract awards (UCA) to a numerical value. 1 for UCA, 0 for otherwise.
*  lOffer is the natural log of the number of offers received. Uncompeted contracts are classified as having received one offer.


In addition, l_Ceil and l_Days are rescaled to have an average value of 0 and a standard deviation of one. This standardizes interpretation and prevents a "very large eigen value" error later when l_Ceil:lDay is introduced.

```{r ReadInData, echo = TRUE}
  load(file="Data/defense_contract_CSIScontractID_detail.Rdata")
  

head(DefenseModelAndDetail)


```



Next, we eliminate missing data entries and then draw a sample. The final computation uses all of the data, but as a computation shortcut, only a subset of the data is needed to allow for processing of models in minutes rather than hours.

###Computational Sample Creation
```{r Sample}

DefenseModelAndDetail<-transform_contract(DefenseModelAndDetail)

Term_smp<-DefenseModelAndDetail[!is.na(DefenseModelAndDetail$b_Term)&
                                  !is.na(DefenseModelAndDetail$Comp),]


Term_smp<-Term_smp[sample(nrow(Term_smp),250000),]


Term_smp$cl_Ceil<-scale(Term_smp$l_Ceil)
Term_smp$cl_Days<-scale(Term_smp$l_Days)
Term_smp$cb_Comp<-scale(Term_smp$b_Comp)
Term_smp$cn_Comp<-scale(Term_smp$n_Comp)
Term_smp$cn_Offr<-scale(Term_smp$n_Offr)
Term_smp$cl_Offer<-scale(Term_smp$l_Offer)


head(Term_smp)

```

#Estimate Model

##Study Variable: Competition
Competition has the potential to reduce terminations by giving the government more options in vendors and encouraging better behavior from the contractor that was chosen. 
###Model 01A: No Competition / Competition
```{r Model01A}

#First a quick frequency plot for terminations
Term_bar_01A<-ggplot(data=Term_smp,
       aes(x=Term))+geom_histogram(stat="count")+facet_wrap(~Comp,scales="free_y")
Term_bar_01A



#Plot the percent terminated across b_Comp
Term_01A_line<-ggplot(data=subset(Term_smp,!is.na(b_Comp)) %>% 
  group_by(b_Comp) %>% 
  summarise (mean_Term = mean(b_Term)),
       aes(y=mean_Term,x=b_Comp))+geom_line()
Term_01A_line


Term01A <- glm (data=Term_smp,
                 b_Term ~ cb_Comp, family=binomial(link="logit"))
display(Term01A)
coef(Term01A)


#Plot the 
Term_scat_01A<-ggplot(data=Term_smp,
       aes(y=j_Term,x=cb_Comp))+geom_jitter(alpha=0.01,height=0)

#Add the fitted regression line
Term_scat_01A<-Term_scat_01A+ stat_function(fun = fit_curve, args=list(a=coef(Term01A)[1],
                                                        b=coef(Term01A)[2]),
                             color="blue")
Term_scat_01A

Term_data_01A<-data.frame(fitted=fitted(Term01A),
                       residuals=residuals(Term01A),
                       b_Term=Term01A$model$b_Term,
                       cb_Comp=Term01A$model$cb_Comp
                       )

#Save this for a future GLM
# Term_data_01A<-data.frame(fitted=fitted(Term01A),
#                        residuals=residuals(Term01A),
#                        nTerm=Term01A@frame$nTerm,
#                        cb_Comp=Term01A@frame$cb_Comp
#                        )

Term_data_01A<-Term_data_01A[order(Term_data_01A$fitted),]

Term_res_01A<-ggplot(data=Term_data_01A,
       aes(y=b_Term,x=fitted))+geom_jitter(alpha=0.01)
Term_res_01A
# +
  # scale_x_continuous(limits=c(0,1))+
  # scale_y_continuous(limits=c(0,1))
  # position_jitter(width = NULL, height = NULL)


```
Competition alone has a very slight, but significant, negative correlation with terminations. The next step is to check alternate formulations. There's not yet enough in this model for any meaningful residual models. The next step is to look at a more detailed model, where single offer competition is broken out as a middle option between competition and no competion.

###Model 01B: No Competition / Single Offer / Competition
```{r Model01B}

#First a quick frequency plot for terminations
Term_bar_01B<-ggplot(data=Term_smp,
       aes(x=Term))+geom_histogram(stat="count")+facet_wrap(~n_Comp,scales="free_y")
Term_bar_01B

#Plot the percent terminated across n_Comp
Term_01B_line<-ggplot(data=subset(Term_smp,!is.na(n_Comp)) %>% 
  group_by(n_Comp) %>% 
  summarise (mean_Term = mean(b_Term)),
       aes(y=mean_Term,x=n_Comp))+geom_line()
Term_01B_line


Term01B <- glm (data=Term_smp,
                 b_Term ~ cn_Comp, family=binomial(link="logit"))
display(Term01B)
coef(Term01B)


#Plot the 
Term_scat_01B<-ggplot(data=Term_smp,
       aes(y=j_Term,x=cn_Comp))+geom_jitter(alpha=0.01,height=0)

#Add the fitted regression line
Term_scat_01B<-Term_scat_01B+ stat_function(fun = fit_curve, args=list(a=coef(Term01B)[1],
                                                        b=coef(Term01B)[2]),
                             color="blue")
Term_scat_01B

Term_data_01B<-data.frame(fitted=fitted(Term01B),
                       residuals=residuals(Term01B),
                       b_Term=Term01B$model$b_Term,
                       cn_Comp=Term01B$model$cn_Comp
                       )


Term_data_01B<-Term_data_01B[order(Term_data_01B$fitted),]

Term_res_01B<-ggplot(data=Term_data_01B,
       aes(y=b_Term,x=fitted))+geom_jitter(alpha=0.01)
Term_res_01B


```


The correltion between the three categories of competition has a smaller coefficent, but is still signficant. In the next step, the multiple award competition is broken down in greater detail.

###Model 01C: No Competition / Number of Offer Categories 
```{r Model01C}

#First a quick frequency plot for terminations
Term_01C_bar<-ggplot(data=Term_smp,
       aes(x=Term))+geom_histogram(stat="count")+facet_wrap(~n_Offr,scales="free_y")
Term_01C_bar


#Plot the percent terminated across n_Offr 
Term_01C_line<-ggplot(data=subset(Term_smp,!is.na(n_Offr)) %>% 
  group_by(n_Offr) %>% 
  summarise (mean_Term = mean(b_Term)),
       aes(y=mean_Term,x=n_Offr))+geom_line()
Term_01C_line



Term01C <- glm (data=Term_smp,
                 b_Term ~ cn_Offr, family=binomial(link="logit"))
display(Term01C)
coef(Term01C)



#Plot the 
Term_01C_scat<-ggplot(data=Term_smp,
       aes(y=j_Term,x=cn_Offr))+geom_jitter(alpha=0.01,height=0)

#Add the fitted regression line
Term_01C_scat<-Term_01C_scat+ stat_function(fun = fit_curve, args=list(a=coef(Term01C)[1],
                                                        b=coef(Term01C)[2]),
                             color="blue")
Term_01C_scat

Term_01C_data<-data.frame(fitted=fitted(Term01C),
                       residuals=residuals(Term01C),
                       b_Term=Term01C$model$b_Term,
                       cn_Offr=Term01C$model$cn_Offr
                       )


Term_01C_data<-Term_01C_data[order(Term_01C_data$fitted),]

Term_01C_res<-ggplot(data=Term_01C_data,
       aes(y=b_Term,x=fitted))+geom_jitter(alpha=0.01)
Term_01C_res


```

Becuse the 5+ offers category has a higher termination rate than 2 and 3-4, the coefficient for the five category breakdown on competition is smaller than the three. In theory, this could be because of non-liner relationship, for example higher number of offers competition may be more vulnerable to aggressive bidding beavior. However, this explaination would likely be better captured by other hidden variables such as competition methods rather than having a direct relationship with an increased number of offers. As a result, we are not testing offers as a categorical variable with dummies. Instead, the last variant to be checked is the number of offers directly. This is handled logarithmicly because the differences between number of offers at the bottom end of the scle mtters much more than at the high end of the scale. In this method, contracts that were not open to competition are grouped with contracts that received only a single offer.


###Model 01D: Number of Offer Categories 
```{r Model01D}


#First a quick frequency plot for terminations
Term_01D_bar<-ggplot(data=Term_smp,
                     aes(x=l_Offer))+geom_histogram(bins =20)+
  facet_wrap(~Term,ncol=1,scales="free_y")
Term_01D_bar
Term_01D_bar+facet_grid(Term~Veh,scales="free_y")
  theme(strip.text.x = element_text(angle = 90))

Term_smp$bin_Offer<-cut(Term_smp$l_Offer,20)

#Plot the percent terminated across offers 
Term_01D_line<-ggplot(data=subset(Term_smp,!is.na(bin_Offer)) %>% 
  group_by(bin_Offer) %>% 
  summarise (mean_Term = mean(b_Term),
             mean_l_Offer =mean(l_Offer)),
       aes(y=mean_Term,x=mean_l_Offer))+geom_point()
Term_01D_line

#Plot the percent terminated across offers and fixed price/cost based
Term_01D_line_FxCb<-ggplot(data=subset(Term_smp,!is.na(bin_Offer) & !is.na(FxCb)) %>% 
  group_by(bin_Offer,FxCb) %>% 
  summarise (mean_Term = mean(b_Term),
             mean_l_Offer =mean(l_Offer)),
       aes(y=mean_Term,x=mean_l_Offer))+geom_point()+facet_wrap(~FxCb)
Term_01D_line_FxCb

#Plot the percent terminated across offers and Product/Service/R&D
Term_01D_line_PSR<-ggplot(data=subset(Term_smp,!is.na(bin_Offer) & !is.na(PSR)) %>% 
  group_by(bin_Offer,PSR) %>% 
  summarise (mean_Term = mean(b_Term),
             mean_l_Offer =mean(l_Offer)),
       aes(y=mean_Term,x=mean_l_Offer))+geom_point()+facet_wrap(~PSR)
Term_01D_line_PSR

#Plot the percent terminated across Vehicle
Term_01D_line_Veh<-ggplot(data=subset(Term_smp,!is.na(bin_Offer) & !is.na(Veh) ) %>% 
  group_by(bin_Offer,Veh) %>% 
  summarise (mean_Term = mean(b_Term),
             mean_l_Offer =mean(l_Offer)),
       aes(y=mean_Term,x=mean_l_Offer))+geom_point()+facet_wrap(~Veh)
Term_01D_line_Veh


Term01D <- glm (data=Term_smp,
                 b_Term ~ cl_Offer, family=binomial(link="logit"))
display(Term01D)
coef(Term01D)


#Plot the 
Term_01D_scat<-ggplot(data=Term_smp,
       aes(y=j_Term,x=cl_Offer))+geom_jitter(alpha=0.01,height=0)

#Add the fitted regression line
Term_01D_scat<-Term_01D_scat+ stat_function(fun = fit_curve, args=list(a=coef(Term01D)[1],
                                                        b=coef(Term01D)[2]),
                             color="blue")
Term_01D_scat

Term_01D_data<-data.frame(fitted=fitted(Term01D),
                       residuals=residuals(Term01D),
                       b_Term=Term01D$model$b_Term,
                       cl_Offer=Term01D$model$cl_Offer
                       )


Term_01D_data<-Term_01D_data[order(Term_01D_data$fitted),]

Term_01D_res<-ggplot(data=Term_01D_data,
       aes(y=b_Term,x=fitted))+geom_jitter(alpha=0.01)
Term_01D_res


```

Closer examination further undercuts the idea that more offers is associated with a lower termination risk. A variety of binned percent terminated graphs found that in the middle range of the number of offers, there is often an increase in the percent terminated. The study team had expected that this phenomenon may prove isolated to a certain type of contracting mechanism or product/service, but that did not prove to be the case.

The difference between single-offer and effective competition is worth exploring, even if it lowers the significance of the starting model. However, lacking a specific theoretical argument for the importance of a greater number of offers, and given the results, the more detailed competition breakdowns will not be used. This may be an issue worth exploring more in a future work.


##Scope Variables
###Model 02A: Cost Ceiling

The model starts by examing the influence of large ceilings on contracts, the core idea here, as observed in the fixed priced paper, is that larger contracts are at greater risk of termination. This can be explained by both the inherent risk in the contract and high transaction costs of contract termination which discourage making the effort for smaller contracts.

```{r Model02A}

#First a quick frequency plot for terminations
Term_02A_bar<-ggplot(data=Term_smp,
       aes(x=l_Offer))+geom_histogram(bins=20)+facet_wrap(~Term,ncol=1,scales="free_y")
Term_02A_bar

#Plot the percent terminated across offers 
Term_02A_line<-ggplot(data=subset(Term_smp,!is.na(l_Offer)) %>% 
  group_by(l_Offer) %>% 
  summarise (mean_Term = mean(b_Term)),
       aes(y=mean_Term,x=l_Offer))+geom_line()
Term_02A_line

Term_02A <- glm (data=Term_smp,
                 b_Term ~n_Comp + l_Ceil, family=binomial(link="logit"))
display(Term_02A)



Term_02A_plot<-ggplot(data=Term_smp,
       aes(y=j_Term,x=l_Ceil))+geom_point(alpha=0.01)

Term_02A_curve<-function(x, Comp){invlogit(cbind(1,Comp,x) %*%  coef(Term_02A))}

Term_02A_plot+ stat_function(fun = Term_02A_curve, 
                             args=list(Comp=0),color="blue")+
  stat_function(fun = Term_02A_curve, 
                             args=list(Comp=1),color="blue")



ggplot(data=Term_smp,
       aes(y=b_Term,x=l_Ceil,color=cb_Comp))+geom_point()+scale_color_continuous(low="red",high="blue")




Term15data<-data.frame(fitted=fitted(Term15H),
                       residuals=residuals(Term15H),
                       nTerm=Term15H@frame$nTerm,
                       cb_Comp=Term15H@frame$cb_Comp
                       )

Term15data<-Term15data[order(Term15data$fitted),]

ggplot(data=Term15data,
       aes(y=nTerm,x=fitted,color=cb_Comp))+geom_point(alpha=0.01)+scale_color_continuous(low="red",high="blue")+
  scale_x_continuous(limits=c(0,1))+
  scale_y_continuous(limits=c(0,1))
  # position_jitter(width = NULL, height = NULL)



```

###Model 02B: Cost Ceiling and Competition



```{r Model02B}

Term_02B <- glm (data=Term_smp,
                 b_Term ~n_Comp + l_Ceil + n_Comp:l_Ceil, family=binomial(link="logit"))
display(Term_02B)



Term_02B_plot<-ggplot(data=Term_smp,
       aes(y=j_Term,x=l_Ceil))+geom_point(alpha=0.01)

Term_02B_curve<-function(x, Comp){invlogit(cbind(1,Comp,x,Comp*x) %*%  coef(Term_02B))}

Term_02B_plot+ stat_function(fun = Term_02B_curve, 
                             args=list(Comp=0),color="blue")+
  stat_function(fun = Term_02B_curve, 
                             args=list(Comp=1),color="blue")



ggplot(data=Term_smp,
       aes(y=b_Term,x=l_Ceil,color=cb_Comp))+geom_point()+scale_color_continuous(low="red",high="blue")




Term15data<-data.frame(fitted=fitted(Term15H),
                       residuals=residuals(Term15H),
                       nTerm=Term15H@frame$nTerm,
                       cb_Comp=Term15H@frame$cb_Comp
                       )

Term15data<-Term15data[order(Term15data$fitted),]

ggplot(data=Term15data,
       aes(y=nTerm,x=fitted,color=cb_Comp))+geom_point(alpha=0.01)+scale_color_continuous(low="red",high="blue")+
  scale_x_continuous(limits=c(0,1))+
  scale_y_continuous(limits=c(0,1))
  # position_jitter(width = NULL, height = NULL)



```
The interaction went in the expected direction, but is surprisingly powerful. Competition heightens the importance of contract ceiling, and larger contract ceilings mitigate the importance of competition. The other powerful part of this interaction was the dramatic increase in the coefficient for competition and the comparative reduction in the correlation of ceiling.

###Model 02C: Maximum Duration

```{r Model02C}


Term_02C <- glm (data=Term_smp,
                 b_Term ~n_Comp + l_Ceil + n_Comp:l_Ceil + l_Days, family=binomial(link="logit"))
display(Term_02C)



Term_02C_plot<-ggplot(data=Term_smp,
       aes(y=j_Term,x=l_Ceil))+geom_point(alpha=0.01)

Term_02C_curve<-function(x, Comp){invlogit(cbind(1,Comp,x,Comp*x) %*%  coef(Term_02C))}

Term_02C_plot+ stat_function(fun = Term_02C_curve, 
                             args=list(Comp=0),color="blue")+
  stat_function(fun = Term_02C_curve, 
                             args=list(Comp=1),color="blue")


Term_02C <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + 
               l_Days  +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term_02C)

```
The initial model results are as expected, but the relationship between initial contract ceiling and terminations is weak compared to what was observed in data exploration. This may be because of the interaction between the two terms. Both initial ceiling and duration are seperately associated with a higher risk of termination, but what is the influence of contracts that are expected to be both long lasting and large?

###Model 11C: Interation of Ceiling and Duration
```{r Model02C}

Term_02C <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + 
               l_Days + l_Ceil:l_Days +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term_02C)
```

The combination of ceiling and duration has a pronounced impact on reducing the risk of termination. The increase to the coefficient for cost ceiling is particularly pronounced. This is consistent with the idea that large but short time frame contracts are especially high risk.

##Contract Vehicle
Our dataset includes both stand alone contract awards and task orders that are under larger indefinite delivery vehilces (IDVs). 

###Model 12A: Any IDV
```{r Model12A}

Term12A <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + l_Days + l_Ceil:l_Days + 
                   IDV +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term12A)
```
The first check lumps all forms of IDVs together, and finds that IDVs face notably lower risks of termination. This may reflect that the Ceiling and Days entries reflect only the task order and not the larger contract. The next step is to check the intersections with ceiling.


###Model 12B: Any IDV and contract ceiling
```{r Model12B}

Term12B <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + l_Days + l_Ceil:l_Days + 
                   IDV + IDV:l_Ceil+
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term12B)
```

The lower rate of task order termination did not prove to be relevant to contract ceiling. The next step is to see whether there is any relationship to maximum duration. Under this theory, the fact that IDVs make it simpler to do multiple short task orders could mask any risk when task order duratio grows longer.

###Model 12C: Any IDV and Maximum Duration
```{r Model12C}

Term12C <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + l_Days + l_Ceil:l_Days + 
                   IDV + IDV:l_Days+
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term12C)
```

The results a dramatic, longer IDVs do face higher risks of termination. That said, the termination risk reduction for all IDVs has grown even further as a result, so even longer task orders may not face greater termination risks than comparable contract awards. With this addition, the intersection of contract ceiling and maximum duration is no longer significant, the next step will be testing its removal from the equation.

###Model 12D: Trimming the intersection of duration and ceiling
```{r Model12D}

Term12D <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + l_Days + 
                   IDV + IDV:l_Days+
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term12D)
```

The removal has little effect on the AIC or DIC but does simplify the model.

Subsequent steps will explore the difference between multiple-award IDVs, where the government can choose from a pre-qualified pool of vendors, and single-award IDVs, where the government only has one option. 

###Model 12E: Single-Award IDV
```{r Model12E}

Term12E <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + l_Days + 
                   SIDV + 
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term12E)
```

Single-award IDVs closely align with the role played by IDVs as a whole, and increase the predictive power of the model, as measured by AIC and DIC. 

###Model 12F: Multiple-Award IDVs
```{r Model12F}

Term12F <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + l_Days + 
                   SIDV + MIDV +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term12F)
```

Multiple-Award IDVs also reduce the termination rate, but not to nearly the same extent as single-awrd IDVs. However, coefficient is sufficient to merit inclusion in the model.

###Model 12G: Other IDVs
```{r Model12G}

Term12G <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + l_Days + 
                   SIDV + MIDV + OIDV +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term12G)
```
Other IDVs has the weakest relationship of the three, but still is significant. The next step is to test if interactions with maximum duration still add value to the model, starting with single-award.


###Model 12H: Single-Award IDVs and Maximum duration
```{r Model12H}

Term12H <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + l_Days + 
                   SIDV + MIDV + OIDV + SIDV:l_Days +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term12H)
```

The pattern for single-award IDVs and duration is a slightly magnified version of the phenonemon for IDVs overall shown in mdel 2C. 

###Model 12I: Single-Award IDVs and Maximum duration

```{r Model12I}

Term12I <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + l_Days + 
                   SIDV + MIDV + OIDV + SIDV:l_Days + MIDV:l_Days +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term12I)
```
The error is a bit higher for multiple source IDVs interacting with duration, as compared to single-award IDVs. In addition, the model failed to converge, so leaving out this interaction.

###Model 12J: Other IDVs and Maximum duration

```{r Model12J}

Term12J <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + l_Days + 
                   SIDV + MIDV + OIDV + SIDV:l_Days + OIDV:l_Days +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term12J)
```
Interesting enough, other IDVs have the opposite interaction with single-award IDVs as does single-award IDVs. Shorter duration other IDVs slightly raise termination risks while longer reduce them relative to other sorts of vehicles. However, the coefficient for other IDVs no longer exceeds the standard error, so leaving this parameter out.

##Type of Contract Variables
###Model 13A: Fixed-Price Contracts

The next step adds a measure for whether the contract was cost-based or fixed-price. Prior CSIS research has found that fixed-price contracts do face a higher risk of termination across the board.

```{r Model13A}

Term13A <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + l_Days + 
                   SIDV + MIDV + OIDV + SIDV:l_Days + 
                   n_Fixed +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term13A)
```

And fixed price contracts do indeed have a appreciably higher average termination rate. This does not improve the overall AIC of the model, but it captures another important dynamic and has a coefficient that greatly exceeds its standard error. 

###Model 13B: Fixed-Price and Maximum Duration
Past CSIS research has found that fixed-price contracts do appear to be at higher risk if they have a longer maximum duration. Fixed-price contracting does require upfront estimation of likely costs, and thus a longer duration means more opportunity for changed circumstance.

```{r Model13B}

Term13B <- glmer (data=Term_smp,
                  b_Term ~ l_Ceil + l_Days + 
                   SIDV + MIDV + OIDV + SIDV:l_Days + 
                   n_Fixed + l_Days:n_Fixed +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term13B)

```
The model failed to converge and the coefficient, while large, did not exceed the standard error. That said, it is worth noting that the sign went in the opposite direction from what was expected, with longer fixed-price contracts not being associated with disproprtionately higher terminations rates. Thus, the earlier finding is not replicated. 

###Model 13C: Incentive Fees

In the performance of the defense acquisition system report, the benefits found were reduced cost overruns. That could help avoid terminations, but it's an indirect connection at best. 

```{r Model13C}

Term13C <- glmer (data=Term_smp,
                  b_Term ~ l_Ceil + l_Days + 
                   SIDV + MIDV + OIDV + SIDV:l_Days + 
                   n_Fixed + nIncent +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term13C)
```

###Model 13D: Undefinitized Contract Awards
Undefinitized Contract Awards allow for quick action in situations where there is not time or information to establish all of a contracts properties at the time of signing. They have been found by the GAO and the Performance of the Defense Acquisition studies to contain notable risks, primarily relating to cost overruns. Will these risks also carry into terminations?

```{r Model3D}
#Run through stopped here
Term3D <- glmer (data=Term_smp,
                  b_Term ~ l_Ceil + l_Days + 
                   SIDV + MIDV + OIDV + SIDV:l_Days + 
                   n_Fixed  + n_UCA +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term3D)

```

Use of UCA significantly increases risks of termination, well in excess of the error term. Interestingly, while this addition further reduceds the AIC and DIC of the model, it also increases the coefficient for fixed price contracts.

##Place of Performance
###Model 14A: Any International

```{r Model4A}

Term4A <- glmer (data=Term_smp,
                  b_Term ~ l_Ceil + l_Days + 
                   SIDV + MIDV + OIDV + SIDV:l_Days + 
                   n_Fixed  + n_UCA +
                   nIntl +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term4A)

```

International performance of contract proved to not be an effective predictor of contract termination. In addition, the model failed to converge. This variable will not be added.

##Competition Variables
###Model 15A: Competition



###Model 15C: Competition and Fixed Price 

```{r Model5C}
Term15C <- glmer (data=Term_smp,b_Term ~ l_Ceil + l_Days + 
                   SIDV + MIDV + OIDV + SIDV:l_Days + 
                   n_Fixed  + n_UCA +
                   cb_Comp + cb_Comp:n_Fixed +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term15C)

```
THese results are not sufficiently signficiant to justify inclusion, but the interaction between fixed price and competition is potentially interesting and suggests that the demographics of competed contrats may be one factor driving their increase in termination risk. Specifically, one possibility may be that competitive fixed-price contracts are at greater risk of aggressive bids that increase contract risk. 

###Model 15D: Fixed Price and Number of Offers for Competed Contracts

```{r Term15D}
Term15D <- glmer (data=subset(Term_smp,cb_Comp==1),
              b_Term ~ l_Ceil + l_Days + 
                SIDV + MIDV + OIDV + SIDV:l_Days + 
                   n_Fixed  + n_UCA +  lOffer + lOffer:n_Fixed +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term15D)

```

Focusing again on only those contracts that were competed, there does not appear to be a relationship between fixed price contracting and the number of offers. This undercuts the idea that the competition dynamics can be explained as simply relating to aggressive bidding on fixed price contracts.

###Model 15E: Competition and Contract Ceiling
```{r Term15E}
Term15E <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + l_Days +
                   SIDV + MIDV + OIDV + SIDV:l_Days +
                n_Fixed  + n_UCA +  
                  cb_Comp + cb_Comp:l_Ceil +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term15E)


```
The coefficient for the interaction of Ceiling and Competition exceeds the standard error, but only minimally. The model also fails to converge, so we'll leave out this interaction.

###Model 15F: Single-Award IDVs and Competition 
The next step is to check interactions with the contract vehicles. Each has a slightly different approach to competition. For example, the competition for a Single-Award IDV happens at the start of the IDV, after that, contracts awarded through that vehicle go to that single winning vendor.

```{r Term15F}
Term15F <- glmer (data=Term_smp,
                b_Term ~ l_Ceil + l_Days +
                SIDV + MIDV + OIDV + SIDV:l_Days +
                n_Fixed  + n_UCA +  
                cb_Comp + cb_Comp:SIDV + 
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term15F)


```
That result proved stronger than expected and does seem to show that that competed IDVs do have a lower average risk of terminations. However, the model failed to converge.

Next, we'll check the same relationship, but with number of offers instead.

###Model 15G: Single-Award IDVs and Number of Offers 

```{r Term15G}
Term15G <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + l_Days +
                SIDV + MIDV + OIDV + SIDV:l_Days +
                n_Fixed  + n_UCA +
                lOffer + lOffer:SIDV + 
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term15G)

```
The model likewise failed to converge with number of offers and the number of offers proved a less powerful interaction variable than extent of competition.


###Model 15H: Multiple-Award IDVs and Competition

```{r Term15H}
Term15H <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + l_Days +
                SIDV + MIDV + OIDV + SIDV:l_Days +
                n_Fixed  + n_UCA +
                cb_Comp + cb_Comp:MIDV + 
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term15H)
nrow(Term_smp[!is.na(Term_smp$l_Ceil) &
                !is.na(Term_smp$lDays) &
                !is.na(Term_smp$IDV) &
              !is.na(Term_smp$nUCA) & 
                !is.na(Term_smp$Fixed)
                !is.na(Term_smp$cb_Comp),])

```
The combination of competition and multiple-award IDVs is powerful. Multiple-award IDVs entirely explains the competition 

###Model 15I: Multiple-Award IDVs and Number of Offers
```{r Term15I}
Term15I <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + l_Days +
                SIDV + MIDV + OIDV + SIDV:l_Days +
                n_Fixed  + n_UCA +
                lOffer + MIDV:lOffer + 
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term15I)

```
###Model 15J: Other IDVs and Competition

Unlike the existance of competition, having more offers does not have the same dramatic relationship with multi-award IDVs that it does with competition. This does raise the question as to whether the long tail of high numbers of offers might be undercutting the relationship. However, for now, we will stick with competition. 

```{r Term15J}
Term15J <- glmer (data=Term_smp,
                 b_Term ~ l_Ceil + l_Days +
                SIDV + MIDV + OIDV + SIDV:l_Days +
                n_Fixed  + n_UCA +
                cb_Comp + cb_Comp:MIDV + cb_Comp:OIDV +
               (1 | Who) + (1 | PSR_What) + (1 | StartFY), family=binomial(link="logit"))
display(Term15J)

```
Competition and Other IDVs only slightly exceeds the standard error.


##Selection: Model 05H

While the direction of competition is still puzzling, the interaction with Multiple-Award clarifies it somewhat. The study team will use model 05A going forward.

```{r Final Model}
TermModel<-Term15H
display(Term15H)


```