# Path<-"C:\\Users\\gsand_000.ALPHONSE\\Documents\\Development\\R-scripts-and-data\\"
Path<-"K:\\2007-01 PROFESSIONAL SERVICES\\R scripts and data\\"
source(paste(Path,"lookups.r",sep=""))
rm(list = ls())
library(tidyverse)
library(csis360)
Path<-"C:\\Users\\gsand_000.ALPHONSE\\Documents\\Development\\R-scripts-and-data\\"
# Path<-"K:\\2007-01 PROFESSIONAL SERVICES\\R scripts and data\\"
source(paste(Path,"lookups.r",sep=""))
rm(list = ls())
library(tidyverse)
library(csis360)
# Path<-"C:\\Users\\gsand_000.ALPHONSE\\Documents\\Development\\R-scripts-and-data\\"
Path<-"K:\\2007-01 PROFESSIONAL SERVICES\\R scripts and data\\"
source(paste(Path,"lookups.r",sep=""))
file<-unz("Data\\Defense_Vendor_EntityIDhistoryNAICS.zip",
filename="Defense_Vendor_EntityIDhistoryNAICS.txt")
# defense_naics_vendor <- read_tsv(file,
#                           col_names = TRUE,
#                           na = c("","NA","NULL"))
defense_naics_vendor <- read.table(file,
header = TRUE,
na.strings = c("","NA","NULL"),
quote="\"",#Necessary because there are some 's in the names.
sep = "\t")
defense_naics_vendor<-apply_lookups(Path,defense_naics_vendor)
file<-unz("Data\\Defense_Vendor_EntityIDhistory.zip",
filename="Defense_Vendor_EntityIDhistory.txt")
defense_vendor <- read.table(file,
header = TRUE,
na.strings = c("","NA","NULL"),
quote="\"",#Necessary because there are some 's in the names.
sep = "\t")
defense_vendor<-apply_lookups(Path,defense_vendor)
save(defense_naics_vendor,defense_vendor,file="defense_naics_vendor.Rdata")
names<-unique(defense_vendor$ParentID)
names[toupper(names) %in% toupper(c(
"MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
))]
updated_vendor<-key_vendor_2016
key_vendor_2016$Sample<-"Original"
updated_vendor$Sample<-"Merged"
updated_vendor<-rbind(key_vendor_2016,updated_vendor)
updated_vendor$VendorName<-updated_vendor$ParentID
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("DigitalGlobe")&
updated_vendor$Sample=="Merged"]<-"MDA"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Rockwell Collins")&
updated_vendor$Sample=="Merged"]<-"UNITED TECH"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Orbital Sciences")&
updated_vendor$Sample=="Merged"]<-"NORTHROP GRUMMAN"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Aurora Flight Sciences")&
updated_vendor$Sample=="Merged"]<-"BOEING"
updated_vendor<-key_vendor_2016
key_vendor_2016<-subset(defense_vendor_2016,pos<=10 |
toupper(ParentID) %in% toupper(c("MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
)))
defense_vendor_2016<-ddply(defense_vendor_2016,
.(Fiscal.Year),
transform,
pos = rank(-Action.Obligation,
ties.method ="min"))
defense_vendor_2016 <- filter(defense_vendor,Fiscal.Year >= as.Date("2016-01-01"))
defense_vendor_2016<-ddply(defense_vendor_2016,
.(Fiscal.Year),
transform,
pos = rank(-Action.Obligation,
ties.method ="min"))
key_vendor_2016<-subset(defense_vendor_2016,pos<=10 |
toupper(ParentID) %in% toupper(c("MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
)))
updated_vendor<-key_vendor_2016
key_vendor_2016$Sample<-"Original"
updated_vendor$Sample<-"Merged"
updated_vendor<-rbind(key_vendor_2016,updated_vendor)
updated_vendor$VendorName<-updated_vendor$ParentID
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("DigitalGlobe")&
updated_vendor$Sample=="Merged"]<-"MDA"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Rockwell Collins")&
updated_vendor$Sample=="Merged"]<-"UNITED TECH"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Orbital Sciences")&
updated_vendor$Sample=="Merged"]<-"NORTHROP GRUMMAN"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Aurora Flight Sciences")&
updated_vendor$Sample=="Merged"]<-"BOEING"
updated_vendor<-ddply(updated_vendor,
.(Fiscal.Year,VendorName,Sample),
transform,
Merged.2016 = sum(Obligation.2016)
)
updated_vendor$ParentLabel<-as.character(updated_vendor$ParentID)
updated_vendor$ParentLabel[updated_vendor$Sample=="Merged"]<-""
ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_text(aes(label=ParentLabel))+
theme(legend.position="none")
ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_text(aes(label=ParentLabel,hjust=1))+
theme(legend.position="none")
ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_text(aes(label=ParentLabel,hjust=0))+
theme(legend.position="none")
library(ggrepel)
install.packages("ggrepel")
ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_label_repel(aes(label = ParentLabel),
nudge_x = 1,
na.rm = TRUE)+
# geom_text(aes(label=ParentLabel,hjust=0))+
theme(legend.position="none")
library(ggrepel)
ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_label_repel(aes(label = ParentLabel),
nudge_x = 1,
na.rm = TRUE)+
# geom_text(aes(label=ParentLabel,hjust=0))+
theme(legend.position="none")
?read_and_join
csis360::read_and_join(defense_vendor,
"Lookup_ParentID.csv",
by="ParentID"
# NA.check.columns="Fair.Competed"
)
defense_vendor<-csis360::read_and_join(defense_vendor,
"Lookup_ParentID.csv",
path="https://raw.githubusercontent.com/CSISdefense/Lookup-Tables/master/",
by="ParentID",
directory="vendor//"
# NA.check.columns="Fair.Competed"
)
defense_vendor<-csis360::read_and_join(defense_vendor,
"Lookup_ParentID.csv",
path="https://raw.githubusercontent.com/CSISdefense/Lookup-Tables/master/",
by="ParentID",
directory="vendor//",
new_var_checked=FALSE,
add_var="Abbreviation"
# NA.check.columns="Fair.Competed"
)
# Filter defense_naics_vendor to only include fical year ranging from 2008 to 2016
defense_vendor_2016 <- filter(defense_vendor,Fiscal.Year >= as.Date("2016-01-01"))
defense_vendor_2016<-ddply(defense_vendor_2016,
.(Fiscal.Year),
transform,
pos = rank(-Action.Obligation,
ties.method ="min"))
key_vendor_2016<-subset(defense_vendor_2016,pos<=10 |
toupper(ParentID) %in% toupper(c("MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
)))
updated_vendor<-key_vendor_2016
key_vendor_2016$Sample<-"Original"
updated_vendor$Sample<-"Merged"
updated_vendor<-rbind(key_vendor_2016,updated_vendor)
updated_vendor$VendorName<-updated_vendor$ParentID
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("DigitalGlobe")&
updated_vendor$Sample=="Merged"]<-"MDA"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Rockwell Collins")&
updated_vendor$Sample=="Merged"]<-"UNITED TECH"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Orbital Sciences")&
updated_vendor$Sample=="Merged"]<-"NORTHROP GRUMMAN"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Aurora Flight Sciences")&
updated_vendor$Sample=="Merged"]<-"BOEING"
# MDA buying Digital Globe, UTC buying Collins, Northrop buying Orbital, and Boeing buying Aurora
updated_vendor<-ddply(updated_vendor,
.(Fiscal.Year,VendorName,Sample),
transform,
Merged.2016 = sum(Obligation.2016)
)
updated_vendor$ParentLabel<-as.character(updated_vendor$ParentID)
updated_vendor$ParentLabel[updated_vendor$Sample=="Merged"]<-""
ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_label_repel(aes(label = ParentLabel),
nudge_x = 1,
na.rm = TRUE)+
# geom_text(aes(label=ParentLabel,hjust=0))+
theme(legend.position="none")
ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_label_repel(aes(label = Abbreviation),
nudge_x = 1,
na.rm = TRUE)+
# geom_text(aes(label=ParentLabel,hjust=0))+
theme(legend.position="none")
updated_vendor
colnames(updated_vendor)
ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_label_repel(aes(label = Abbreviation),
nudge_x = 1,
na.rm = TRUE)+
# geom_text(aes(label=ParentLabel,hjust=0))+
theme(legend.position="none")
updated_vendor$Abbreviation
csis360::read_and_join(updated_vendor,
"Lookup_ParentID.csv",
path="https://raw.githubusercontent.com/CSISdefense/Lookup-Tables/master/",
by="ParentID",
directory="vendor//",
new_var_checked=FALSE,
add_var="Abbreviation"
# NA.check.columns="Fair.Competed"
)
debug(csis360::read_and_join)
csis360::read_and_join(updated_vendor,
"Lookup_ParentID.csv",
path="https://raw.githubusercontent.com/CSISdefense/Lookup-Tables/master/",
by="ParentID",
directory="vendor//",
new_var_checked=FALSE,
add_var="Abbreviation"
# NA.check.columns="Fair.Competed"
)
View(lookup)
warnings()
load(file="defense_naics_vendor.Rdata")
load(file="defense_naics_vendor.Rdata")
names<-unique(defense_vendor$ParentID)
names[toupper(names) %in% toupper(c(
"MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
))]
csis360::read_and_join(defense_vendor,
"Lookup_ParentID.csv",
path="https://raw.githubusercontent.com/CSISdefense/Lookup-Tables/master/",
by="ParentID",
directory="vendor//",
new_var_checked=FALSE,
add_var="Abbreviation"
# NA.check.columns="Fair.Competed"
)
library(ggrepel)
library(plyr)
load(file="data//defense_naics_vendor.Rdata")
key_vendor<-subset(defense_vendor, Fiscal.Date >=as.Date("2009-01-01")&
pos<=8)
key_vendor<-subset(defense_vendor, Fiscal.Year >=as.Date("2009-01-01")&
pos<=8)
unique(key_vendor$ParentID)
key_vendor<-subset(defense_vendor, Fiscal.Year >=as.Date("2009-01-01")&
(pos<=8 |
toupper(ParentID) %in% toupper(c("MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
))))
updated_vendor<-subset(key_vendor,Fiscal.Year==as.Date("2016-01-01"))
key_vendor$Sample<-paste(key_vendor$Fiscal.Year,"Original")
updated_vendor$Sample<-"2016 Merged"
updated_vendor<-rbind(key_vendor,updated_vendor)
updated_vendor$VendorName<-updated_vendor$ParentID
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("DigitalGlobe")&
updated_vendor$Sample=="Merged"]<-"MDA"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Rockwell Collins")&
updated_vendor$Sample=="Merged"]<-"UNITED TECH"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Orbital Sciences")&
updated_vendor$Sample=="Merged"]<-"NORTHROP GRUMMAN"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Aurora Flight Sciences")&
updated_vendor$Sample=="Merged"]<-"BOEING"
updated_vendor<-ddply(updated_vendor,
.(Fiscal.Year,VendorName,Sample),
transform,
Merged.2016 = sum(Obligation.2016)
)
updated_vendor$ParentLabel<-as.character(updated_vendor$Abbreviation)
updated_vendor$ParentLabel[updated_vendor$Sample!="2016 Merged"]<-""
key_vendor<-subset(defense_vendor, Fiscal.Year >=as.Date("2009-01-01")&
(pos<=8 |
toupper(ParentID) %in% toupper(c("MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
))))
updated_vendor<-subset(key_vendor,Fiscal.Year==as.Date("2016-01-01"))
key_vendor$Sample<-paste(key_vendor$Fiscal.Year,"Original")
updated_vendor$Sample<-"2016 Merged"
updated_vendor<-rbind(key_vendor,updated_vendor)
updated_vendor$VendorName<-updated_vendor$ParentID
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("DigitalGlobe")&
updated_vendor$Sample=="Merged"]<-"MDA"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Rockwell Collins")&
updated_vendor$Sample=="Merged"]<-"UNITED TECH"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Orbital Sciences")&
updated_vendor$Sample=="Merged"]<-"NORTHROP GRUMMAN"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Aurora Flight Sciences")&
updated_vendor$Sample=="Merged"]<-"BOEING"
updated_vendor<-ddply(updated_vendor,
.(Fiscal.Year,VendorName,Sample),
transform,
Merged.2016 = sum(Obligation.2016)
)
updated_vendor<-ddply(updated_vendor,
.(Fiscal.Year,VendorName,Sample),
transform,
Merged.2016 = sum(Obligation.2016)
)
updated_vendor$ParentLabel<-as.character(updated_vendor$Abbreviation)
updated_vendor$ParentLabel[updated_vendor$Sample!="2016 Merged"]<-""
overall_merger<-ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_label_repel(aes(label = ParentLabel),
segment.color = 'grey50',
nudge_x = 0.1,
na.rm = TRUE)+
# geom_text(aes(label=ParentLabel,hjust=0))+
theme(legend.position="none")
overall_merger
defense_vendor<-ddply(defense_vendor,
.(Fiscal.Year),
transform,
pos = rank(-Action.Obligation,
ties.method ="min"),
pct = Action.Obligation / sum(Action.Obligation))
save(defense_naics_vendor,defense_vendor,file="data//defense_naics_vendor.Rdata")
# Filter defense_naics_vendor to only include fical year ranging from 2008 to 2016
key_vendor<-subset(defense_vendor, Fiscal.Year >=as.Date("2009-01-01")&
(pos<=8 |
toupper(ParentID) %in% toupper(c("MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
))))
updated_vendor<-subset(key_vendor,Fiscal.Year==as.Date("2016-01-01"))
key_vendor$Sample<-paste(key_vendor$Fiscal.Year,"Original")
updated_vendor$Sample<-"2016 Merged"
updated_vendor<-rbind(key_vendor,updated_vendor)
updated_vendor$VendorName<-updated_vendor$ParentID
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("DigitalGlobe")&
updated_vendor$Sample=="Merged"]<-"MDA"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Rockwell Collins")&
updated_vendor$Sample=="Merged"]<-"UNITED TECH"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Orbital Sciences")&
updated_vendor$Sample=="Merged"]<-"NORTHROP GRUMMAN"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Aurora Flight Sciences")&
updated_vendor$Sample=="Merged"]<-"BOEING"
# MDA buying Digital Globe, UTC buying Collins, Northrop buying Orbital, and Boeing buying Aurora
updated_vendor<-ddply(updated_vendor,
.(Fiscal.Year,VendorName,Sample),
transform,
Merged.2016 = sum(Obligation.2016)
Merged.pct= sum(Obligation.2016)
updated_vendor<-ddply(updated_vendor,
.(Fiscal.Year,VendorName,Sample),
transform,
Merged.2016 = sum(Obligation.2016),
Merged.pct= sum(Obligation.2016)
)
updated_vendor$ParentLabel<-as.character(updated_vendor$Abbreviation)
updated_vendor$ParentLabel[updated_vendor$Sample!="2016 Merged"]<-""
# updated_vendor$Sample<-ordered(updated_vendor$Sample,c("Original","Merged"))
# Filter defense_naics_vendor to only include fical year ranging from 2008 to 2016
key_vendor<-subset(defense_vendor, Fiscal.Year >=as.Date("2009-01-01")&
(pos<=8 |
toupper(ParentID) %in% toupper(c("MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
))))
updated_vendor<-subset(key_vendor,Fiscal.Year==as.Date("2016-01-01"))
key_vendor$Sample<-paste(key_vendor$Fiscal.Year,"Original")
updated_vendor$Sample<-"2016 Merged"
updated_vendor<-rbind(key_vendor,updated_vendor)
updated_vendor$VendorName<-updated_vendor$ParentID
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("DigitalGlobe")&
updated_vendor$Sample=="Merged"]<-"MDA"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Rockwell Collins")&
updated_vendor$Sample=="Merged"]<-"UNITED TECH"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Orbital Sciences")&
updated_vendor$Sample=="Merged"]<-"NORTHROP GRUMMAN"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Aurora Flight Sciences")&
updated_vendor$Sample=="Merged"]<-"BOEING"
# MDA buying Digital Globe, UTC buying Collins, Northrop buying Orbital, and Boeing buying Aurora
updated_vendor<-ddply(updated_vendor,
.(Fiscal.Year,VendorName,Sample),
transform,
Merged.2016 = sum(Obligation.2016),
Merged.pct= sum(pct)
)
updated_vendor$ParentLabel<-as.character(updated_vendor$Abbreviation)
updated_vendor$ParentLabel[updated_vendor$Sample!="2016 Merged"]<-""
# updated_vendor$Sample<-ordered(updated_vendor$Sample,c("Original","Merged"))
overall_merger<-ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.pct,
color=ParentID,
group=ParentID))+
geom_line()+
geom_label_repel(aes(label = ParentLabel),
segment.color = 'grey50',
nudge_x = 0.1,
na.rm = TRUE)+
# geom_text(aes(label=ParentLabel,hjust=0))+
theme(legend.position="none")
overall_merger
View(key_vendor)
overall_merger
