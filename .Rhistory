# ContractorDisplayName,
# jointventure,
# UnknownCompany,
# WarningFlag,
# Small
),
summarize,
Action.Obligation=sum(Action.Obligation),
numberOfActions=sum(numberOfActions),
Obligation.2016=sum(Obligation.2016)
)
defense_vendor_2016<-ddply(defense_naics_vendor_2016,
.(Fiscal.Year,
AllContractor
# ContractorDisplayName,
# jointventure,
# UnknownCompany,
# WarningFlag,
# Small
),
summarize,
Action.Obligation=sum(Action.Obligation),
numberOfActions=sum(numberOfActions),
Obligation.2016=sum(Obligation.2016)
)
?rank
ddply(defense_vendor_2016,.(Fiscal.Year), transform, pos = rank(Action.Obligation,
ties.method ="min"))
defense_vendor_2016<-ddply(defense_vendor_2016,.(Fiscal.Year), transform, pos = rank(Action.Obligation,
ties.method ="min"))
View(subset(defense_vendor_2016,pos<=5))
(r1 <- rank(x1 <- c(3, 1, 4, 15, 92)))
x2 <- c(3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5)
names(x2) <- letters[1:11]
(r2 <- rank(x2)) # ties are averaged
defense_vendor_2016<-ddply(defense_vendor_2016,.(Fiscal.Year), transform, pos = rank(-Action.Obligation,
ties.method ="min"))
View(subset(defense_vendor_2016,pos<=5))
View(subset(defense_vendor_2016,pos<=5 |
AllContractor %in% c("MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
)))
View(subset(defense_vendor_2016,pos<=5 |
toupper(AllContractor) %in% toupper(c("MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
))))
View(subset(defense_vendor_2016,pos<=10 |
toupper(AllContractor) %in% toupper(c("MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
))))
key_vendor_2016<-subset(defense_vendor_2016,pos<=10 |
toupper(AllContractor) %in% toupper(c("MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
)))
ggplot(key_vendor_2016,
aes(x=Fiscal.Year,
y=Obligation.2016,
color=AllContractor))+
geom_point()
key_vendor_2016$Sample<-"Original"
updated_vendor<-key_vendor_2016
key_vendor_2016$Sample<-"Original"
updated_vendor$Sample<-"Merged"
updated_vendor<-rbind(key_vendor_2016,updated_vendor)
ggplot(updated_vendor,
aes(x=Sample,
y=Obligation.2016,
color=AllContractor))+
geom_point()
ggplot(updated_vendor,
aes(x=Sample,
y=Obligation.2016,
color=AllContractor))+
geom_line()
ggplot(updated_vendor,
aes(x=Sample,
y=Obligation.2016,
color=AllContractor))+
geom_line(group_by(AllContractor))
ggplot(updated_vendor,
aes(x=Sample,
y=Obligation.2016,
color=AllContractor))+
geom_point()
ggplot(updated_vendor,
aes(x=Sample,
y=Obligation.2016,
color=AllContractor))+
geom_line()
?geom_line
ggplot(updated_vendor,
aes(x=Sample,
y=Obligation.2016,
color=AllContractor,
group=AllContractor))+
geom_line()
View(key_vendor_2016)
updated_vendor$VendorName<-updated_vendor$AllContractor
updated_vendor$VendorName[updated_vendor$VendorName=="DigitalGlobe"&
updated_vendor$Sample=="Merged"]<-"MDA"
updated_vendor<-rbind(key_vendor_2016,updated_vendor)
updated_vendor$VendorName<-updated_vendor$AllContractor
updated_vendor$VendorName[updated_vendor$VendorName=="DigitalGlobe"&
updated_vendor$Sample=="Merged"]<-"MDA"
updated_vendor$VendorName[updated_vendor$VendorName=="Rockwell Collins"&
updated_vendor$Sample=="Merged"]<-"United Tech"
updated_vendor$VendorName[updated_vendor$VendorName=="Orbital Sciences"&
updated_vendor$Sample=="Merged"]<-"Northrop Grumman"
updated_vendor$VendorName[updated_vendor$VendorName=="Aurora Flight Sciences"&
updated_vendor$Sample=="Merged"]<-"Boeing"
updated_vendor<-key_vendor_2016
key_vendor_2016$Sample<-"Original"
updated_vendor$Sample<-"Merged"
updated_vendor<-rbind(key_vendor_2016,updated_vendor)
updated_vendor$VendorName<-updated_vendor$AllContractor
updated_vendor$VendorName[updated_vendor$VendorName=="DigitalGlobe"&
updated_vendor$Sample=="Merged"]<-"MDA"
updated_vendor$VendorName[updated_vendor$VendorName=="Rockwell Collins"&
updated_vendor$Sample=="Merged"]<-"United Tech"
updated_vendor$VendorName[updated_vendor$VendorName=="Orbital Sciences"&
updated_vendor$Sample=="Merged"]<-"Northrop Grumman"
updated_vendor$VendorName[updated_vendor$VendorName=="Aurora Flight Sciences"&
updated_vendor$Sample=="Merged"]<-"Boeing"
updated_vendor$VendorName[updated_vendor$VendorName=="DigitalGlobe"&
updated_vendor$Sample=="Merged"]<-"MDA"
updated_vendor$VendorName[updated_vendor$VendorName=="Rockwell Collins"&
updated_vendor$Sample=="Merged"]<-"UNITED TECH"
updated_vendor$VendorName[updated_vendor$VendorName=="Orbital Sciences"&
updated_vendor$Sample=="Merged"]<-"NORTHROP GRUMMAN"
updated_vendor$VendorName[updated_vendor$VendorName=="Aurora Flight Sciences"&
updated_vendor$Sample=="Merged"]<-"BOEING"
ggplot(updated_vendor,
aes(x=Sample,
y=Obligation.2016,
color=AllContractor,
group=AllContractor))+
geom_line()
updated_vendor<-ddply(updated_vendor,
.(Fiscal.Year,VendorName,Sample),
transform,
Obligation.2016 = sum(Obligation.2016)
)
ggplot(updated_vendor,
aes(x=Sample,
y=Obligation.2016,
color=AllContractor,
group=AllContractor))+
geom_line()
View(updated_vendor)
updated_vendor$VendorName[toupper(updated_vendor$AllContractor)==
toupper("DigitalGlobe")&
updated_vendor$Sample=="Merged"]<-"MDA"
updated_vendor$VendorName[toupper(updated_vendor$AllContractor)==
toupper("Rockwell Collins")&
updated_vendor$Sample=="Merged"]<-"UNITED TECH"
updated_vendor$VendorName[toupper(updated_vendor$AllContractor)==
toupper("Orbital Sciences")&
updated_vendor$Sample=="Merged"]<-"NORTHROP GRUMMAN"
updated_vendor$VendorName[toupper(updated_vendor$AllContractor)==
toupper("Aurora Flight Sciences")&
updated_vendor$Sample=="Merged"]<-"BOEING"
updated_vendor<-ddply(updated_vendor,
.(Fiscal.Year,VendorName,Sample),
transform,
Obligation.2016 = sum(Obligation.2016)
)
ggplot(updated_vendor,
aes(x=Sample,
y=Obligation.2016,
color=AllContractor,
group=AllContractor))+
geom_line()
updated_vendor<-key_vendor_2016
key_vendor_2016$Sample<-"Original"
updated_vendor$Sample<-"Merged"
updated_vendor<-rbind(key_vendor_2016,updated_vendor)
updated_vendor$VendorName<-updated_vendor$AllContractor
updated_vendor$VendorName[toupper(updated_vendor$AllContractor)==
toupper("DigitalGlobe")&
updated_vendor$Sample=="Merged"]<-"MDA"
updated_vendor$VendorName[toupper(updated_vendor$AllContractor)==
toupper("Rockwell Collins")&
updated_vendor$Sample=="Merged"]<-"UNITED TECH"
updated_vendor$VendorName[toupper(updated_vendor$AllContractor)==
toupper("Orbital Sciences")&
updated_vendor$Sample=="Merged"]<-"NORTHROP GRUMMAN"
updated_vendor$VendorName[toupper(updated_vendor$AllContractor)==
toupper("Aurora Flight Sciences")&
updated_vendor$Sample=="Merged"]<-"BOEING"
# MDA buying Digital Globe, UTC buying Collins, Northrop buying Orbital, and Boeing buying Aurora
updated_vendor<-ddply(updated_vendor,
.(Fiscal.Year,VendorName,Sample),
transform,
Merged.2016 = sum(Obligation.2016)
)
View(updated_vendor)
rm(list = ls())
library(tidyverse)
library(csis360)
# Path<-"C:\\Users\\gsand_000.ALPHONSE\\Documents\\Development\\R-scripts-and-data\\"
Path<-"K:\\2007-01 PROFESSIONAL SERVICES\\R scripts and data\\"
source(paste(Path,"lookups.r",sep=""))
rm(list = ls())
library(tidyverse)
library(csis360)
Path<-"C:\\Users\\gsand_000.ALPHONSE\\Documents\\Development\\R-scripts-and-data\\"
# Path<-"K:\\2007-01 PROFESSIONAL SERVICES\\R scripts and data\\"
source(paste(Path,"lookups.r",sep=""))
rm(list = ls())
library(tidyverse)
library(csis360)
# Path<-"C:\\Users\\gsand_000.ALPHONSE\\Documents\\Development\\R-scripts-and-data\\"
Path<-"K:\\2007-01 PROFESSIONAL SERVICES\\R scripts and data\\"
source(paste(Path,"lookups.r",sep=""))
file<-unz("Data\\Defense_Vendor_EntityIDhistoryNAICS.zip",
filename="Defense_Vendor_EntityIDhistoryNAICS.txt")
# defense_naics_vendor <- read_tsv(file,
#                           col_names = TRUE,
#                           na = c("","NA","NULL"))
defense_naics_vendor <- read.table(file,
header = TRUE,
na.strings = c("","NA","NULL"),
quote="\"",#Necessary because there are some 's in the names.
sep = "\t")
defense_naics_vendor<-apply_lookups(Path,defense_naics_vendor)
file<-unz("Data\\Defense_Vendor_EntityIDhistory.zip",
filename="Defense_Vendor_EntityIDhistory.txt")
defense_vendor <- read.table(file,
header = TRUE,
na.strings = c("","NA","NULL"),
quote="\"",#Necessary because there are some 's in the names.
sep = "\t")
defense_vendor<-apply_lookups(Path,defense_vendor)
save(defense_naics_vendor,defense_vendor,file="defense_naics_vendor.Rdata")
names<-unique(defense_vendor$ParentID)
names[toupper(names) %in% toupper(c(
"MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
))]
updated_vendor<-key_vendor_2016
key_vendor_2016$Sample<-"Original"
updated_vendor$Sample<-"Merged"
updated_vendor<-rbind(key_vendor_2016,updated_vendor)
updated_vendor$VendorName<-updated_vendor$ParentID
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("DigitalGlobe")&
updated_vendor$Sample=="Merged"]<-"MDA"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Rockwell Collins")&
updated_vendor$Sample=="Merged"]<-"UNITED TECH"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Orbital Sciences")&
updated_vendor$Sample=="Merged"]<-"NORTHROP GRUMMAN"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Aurora Flight Sciences")&
updated_vendor$Sample=="Merged"]<-"BOEING"
updated_vendor<-key_vendor_2016
key_vendor_2016<-subset(defense_vendor_2016,pos<=10 |
toupper(ParentID) %in% toupper(c("MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
)))
defense_vendor_2016<-ddply(defense_vendor_2016,
.(Fiscal.Year),
transform,
pos = rank(-Action.Obligation,
ties.method ="min"))
defense_vendor_2016 <- filter(defense_vendor,Fiscal.Year >= as.Date("2016-01-01"))
defense_vendor_2016<-ddply(defense_vendor_2016,
.(Fiscal.Year),
transform,
pos = rank(-Action.Obligation,
ties.method ="min"))
key_vendor_2016<-subset(defense_vendor_2016,pos<=10 |
toupper(ParentID) %in% toupper(c("MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
)))
updated_vendor<-key_vendor_2016
key_vendor_2016$Sample<-"Original"
updated_vendor$Sample<-"Merged"
updated_vendor<-rbind(key_vendor_2016,updated_vendor)
updated_vendor$VendorName<-updated_vendor$ParentID
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("DigitalGlobe")&
updated_vendor$Sample=="Merged"]<-"MDA"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Rockwell Collins")&
updated_vendor$Sample=="Merged"]<-"UNITED TECH"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Orbital Sciences")&
updated_vendor$Sample=="Merged"]<-"NORTHROP GRUMMAN"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Aurora Flight Sciences")&
updated_vendor$Sample=="Merged"]<-"BOEING"
updated_vendor<-ddply(updated_vendor,
.(Fiscal.Year,VendorName,Sample),
transform,
Merged.2016 = sum(Obligation.2016)
)
updated_vendor$ParentLabel<-as.character(updated_vendor$ParentID)
updated_vendor$ParentLabel[updated_vendor$Sample=="Merged"]<-""
ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_text(aes(label=ParentLabel))+
theme(legend.position="none")
ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_text(aes(label=ParentLabel,hjust=1))+
theme(legend.position="none")
ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_text(aes(label=ParentLabel,hjust=0))+
theme(legend.position="none")
library(ggrepel)
install.packages("ggrepel")
ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_label_repel(aes(label = ParentLabel),
nudge_x = 1,
na.rm = TRUE)+
# geom_text(aes(label=ParentLabel,hjust=0))+
theme(legend.position="none")
library(ggrepel)
ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_label_repel(aes(label = ParentLabel),
nudge_x = 1,
na.rm = TRUE)+
# geom_text(aes(label=ParentLabel,hjust=0))+
theme(legend.position="none")
?read_and_join
csis360::read_and_join(defense_vendor,
"Lookup_ParentID.csv",
by="ParentID"
# NA.check.columns="Fair.Competed"
)
defense_vendor<-csis360::read_and_join(defense_vendor,
"Lookup_ParentID.csv",
path="https://raw.githubusercontent.com/CSISdefense/Lookup-Tables/master/",
by="ParentID",
directory="vendor//"
# NA.check.columns="Fair.Competed"
)
defense_vendor<-csis360::read_and_join(defense_vendor,
"Lookup_ParentID.csv",
path="https://raw.githubusercontent.com/CSISdefense/Lookup-Tables/master/",
by="ParentID",
directory="vendor//",
new_var_checked=FALSE,
add_var="Abbreviation"
# NA.check.columns="Fair.Competed"
)
# Filter defense_naics_vendor to only include fical year ranging from 2008 to 2016
defense_vendor_2016 <- filter(defense_vendor,Fiscal.Year >= as.Date("2016-01-01"))
defense_vendor_2016<-ddply(defense_vendor_2016,
.(Fiscal.Year),
transform,
pos = rank(-Action.Obligation,
ties.method ="min"))
key_vendor_2016<-subset(defense_vendor_2016,pos<=10 |
toupper(ParentID) %in% toupper(c("MDA",  #Check
"DigitalGlobe", #Check
"United Tech", #Check
"Rockwell Collins",  #Check
"Northrop Grumman",  #Check
"Orbital Sciences",
"Boeing", #Check
"Aurora Flight Sciences" #Check but redownload
)))
updated_vendor<-key_vendor_2016
key_vendor_2016$Sample<-"Original"
updated_vendor$Sample<-"Merged"
updated_vendor<-rbind(key_vendor_2016,updated_vendor)
updated_vendor$VendorName<-updated_vendor$ParentID
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("DigitalGlobe")&
updated_vendor$Sample=="Merged"]<-"MDA"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Rockwell Collins")&
updated_vendor$Sample=="Merged"]<-"UNITED TECH"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Orbital Sciences")&
updated_vendor$Sample=="Merged"]<-"NORTHROP GRUMMAN"
updated_vendor$VendorName[toupper(updated_vendor$ParentID)==
toupper("Aurora Flight Sciences")&
updated_vendor$Sample=="Merged"]<-"BOEING"
# MDA buying Digital Globe, UTC buying Collins, Northrop buying Orbital, and Boeing buying Aurora
updated_vendor<-ddply(updated_vendor,
.(Fiscal.Year,VendorName,Sample),
transform,
Merged.2016 = sum(Obligation.2016)
)
updated_vendor$ParentLabel<-as.character(updated_vendor$ParentID)
updated_vendor$ParentLabel[updated_vendor$Sample=="Merged"]<-""
ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_label_repel(aes(label = ParentLabel),
nudge_x = 1,
na.rm = TRUE)+
# geom_text(aes(label=ParentLabel,hjust=0))+
theme(legend.position="none")
ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_label_repel(aes(label = Abbreviation),
nudge_x = 1,
na.rm = TRUE)+
# geom_text(aes(label=ParentLabel,hjust=0))+
theme(legend.position="none")
updated_vendor
colnames(updated_vendor)
ggplot(subset(updated_vendor,pos<=10),
aes(x=Sample,
y=Merged.2016,
color=ParentID,
group=ParentID))+
geom_line()+
geom_label_repel(aes(label = Abbreviation),
nudge_x = 1,
na.rm = TRUE)+
# geom_text(aes(label=ParentLabel,hjust=0))+
theme(legend.position="none")
updated_vendor$Abbreviation
csis360::read_and_join(updated_vendor,
"Lookup_ParentID.csv",
path="https://raw.githubusercontent.com/CSISdefense/Lookup-Tables/master/",
by="ParentID",
directory="vendor//",
new_var_checked=FALSE,
add_var="Abbreviation"
# NA.check.columns="Fair.Competed"
)
debug(csis360::read_and_join)
csis360::read_and_join(updated_vendor,
"Lookup_ParentID.csv",
path="https://raw.githubusercontent.com/CSISdefense/Lookup-Tables/master/",
by="ParentID",
directory="vendor//",
new_var_checked=FALSE,
add_var="Abbreviation"
# NA.check.columns="Fair.Competed"
)
View(lookup)
warnings()
