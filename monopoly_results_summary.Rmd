---
title: "Monopoly Results Summary"
date: "Wednesday, February 8, 2017"
output: 
  html_document: 
    keep_md: yes
    toc: yes

---

#Setup
```{r Libraries, echo = FALSE}
library(csis360)
library(ggplot2)
library(dplyr)
library(arm)
library(R2WinBUGS)
library(knitr)
library(foreign)
library(stargazer)
library(texreg)
source("DIIGstat.r")

axis.text.size<-10
strip.text.size<-10
legend.text.size<-8
# table.text.size<-5.75
title.text.size<-12
geom.text.size<-12

main.text.size<-1
note.text.size<-1.40


```


Contracts are classified using a mix of numerical and categorical variables. While the changes in numerical variables are easy to grasp and summarize, a contract may have one line item that is competed and another that is not. As is detailed in the exploration on R&D, we are only considering information available prior to contract start. The percentage of contract obligations that were competed is a valuable benchmark, but is highly influenced by factors that occured after contract start..

## Contract Terminations

Contract terminations and the number of change orders can be calculated for the entire sample.  Contract termination is determined using the *Reason for Modification* field in FPDS.  A contract is considered to be terminated if it has at least one modification with the following values:

* "Terminate for Default (complete or partial)"
* "Terminate for Convenience (complete or partial)"
* "Terminate for Cause"
* "Legal Contract Cancellation"

These four catetegories and the "Close Out" category are used to mark a contract as closed.  Many contracts in FPDS and in the sample are never marked closed.  


##Prepare Data
First we load the data. The dataset used is a U.S. Defense Contracting dataset derived from   FPDS.


###Data Transformations and Summary



```{r ReadInData, echo = TRUE}
#   load(file="Data/defense_contract_complete.RData")
# # head(def)
debug(transform_contract)
def<-transform_contract(def)
# 
# 
# 
# save(file="Data/transformed_def.Rdata", def)
 load(file="Data/transformed_def.Rdata")
load("output//naics_join.Rdata")

```



## Dependent Variables

NA_stats(def,"b_Term")
* b_Term is a binary variable that has a value of 1 for any contracts that have experienced a partial or complete termination, 0 otherwise. (`r summary(def$b_Term);
sum(def$Action.Obligation[def$b_Term==1],na.rm=TRUE)/sum(def$Action.Obligation,na.rm=TRUE)`
* b_CBre is a binary variable that has a value of 1 for any contracts that have experienced a partial or complete termination, 0 otherwise. (`r summary(def$b_CBre);
sum(def$Action.Obligation[def$b_CBre==1],na.rm=TRUE)/sum(def$Action.Obligation,na.rm=TRUE)
NA_stats(def,"b_CBre")`)

## Independent Variables

### Study Variables

* b_Comp is a binary variable based on competition. It has a value of 0 for uncompeted contracts and a value of 1 for competition, regardless of number of offers. `r  summary(def$Comp);
NA_stats(def,"Comp") `
* n_Comp is a binary variable based on competition. It has a value of 0 for uncompeted contracts and a value of 1 for competition, regardless of number of offers. `r  summary(def$EffComp);
NA_stats(def,"EffComp")
sum(def$Action.Obligation[def$EffComp=="No Comp."],na.rm=TRUE)/sum(def$Action.Obligation,na.rm=TRUE)
sum(def$Action.Obligation[def$EffComp=="1 Offer"],na.rm=TRUE)/sum(def$Action.Obligation,na.rm=TRUE)
sum(def$Action.Obligation[def$EffComp=="2+ Offers"],na.rm=TRUE)/sum(def$Action.Obligation,na.rm=TRUE)`
)

* c_HHI_lag1 is a numeric variable based on the HHI Index of a NAICS code for defense contracting. Index values of 1500 and below are considered unconsolidated. 1500-2000 is considered moderately consolidated. And 2,000 and above are considered highly consolidated. The scale runs from 0 to 10,000. `r summary(def$c_HHI_lag1);
summary(def$l_HHI_lag1);
centered_description(def$HHI_lag1,"HHI score")
centered_log_description(def$l_HHI_lag1,"HHI score")

NA_stats(def,"c_HHI_lag1")`

### Initial Contract Scope
* cl_Ceil is the natural log of the initial contract cost ceiling, in then-year dollars. `r centered_log_description(def$l_Ceil,"dollars");
NA_stats(def,"l_Ceil")`
* cl_Days is the natural log of the initial maximum duration of the contract, in days. The variable is centered, by subtracting its mean (`r centered_log_description(def$l_Days,"days");
NA_stats(def,"l_Days")` 

### Contract Vehicle
* SIDV, MIDV, and FSS/GWAC, BPA/BOA are dummy variables based on the contract vehicle. They correspond to Single-Award IDVs, Multi-Award IDVs, and Other IDVs, respectively, having a value of 1 when the task order has that vehicle type, and having a 0 other. The remaining types, definitive contracts and purchase orders, are intentionally left out. (`r 
summary(def$Veh);
nrow(def[def$Veh =="SINGLE AWARD IDC",])/nrow(def)
nrow(def[def$Veh =="MULTIPLE AWARD IDC",])/nrow(def)
nrow(def[def$Veh =="FSS/GWAC",])/nrow(def)
nrow(def[def$Veh =="BPA/BOA",])/nrow(def)
NA_stats(def,"Veh")`
* n_Fixed is a numeric variable based on contract pricing. It has a value of 0 for cost-based, 0.5 or "combination or other", 1 for any fixed price (excluding fixed-price level of effort which is classified as cost-based). (`r summary(def$n_Fixed);
NA_stats(def,"n_Fixed")
sum(def$Action.Obligation[def$n_Fixed==0],na.rm=TRUE)/sum(def$Action.Obligation,na.rm=TRUE)
sum(def$Action.Obligation[def$n_Fixed==0.5],na.rm=TRUE)/sum(def$Action.Obligation,na.rm=TRUE)
sum(def$Action.Obligation[def$n_Fixed==1],na.rm=TRUE)/sum(def$Action.Obligation,na.rm=TRUE)
nrow(def[def$n_Fixed==0,])/nrow(def)
nrow(def[def$n_Fixed==0.5,])/nrow(def)
nrow(def[def$n_Fixed==1,])/nrow(def)

`)
* n_Incent is a numeric variable based on fee type. Ig has a value. 1 for incentive fee or cost sharing, 0.5 or "combination or other", 0 for all remaining types. (`r summary(def$n_Incent);
summary(def$Fee)
NA_stats(def,"n_Incent")`)
* b_UCA is a binary variable with a value of 1 for contracts/task orders that begin as letter contracts or undefinitized contract awards (UCA) and a value of 0 otherwise. `r summary(def$b_UCA);
sum(def$Action.Obligation[def$b_UCA==1],na.rm=TRUE)/sum(def$Action.Obligation,na.rm=TRUE)
length(def[def$b_UCA==1,])/sum(def$Action.Obligation,na.rm=TRUE)
NA_stats(def,"b_UCA")`
* b_Intl is a binary variable with a value of 1 for contracts/task orders with any transactions performed internationally and a value of 0 otherwise. `r summary(def$b_Intl);
sum(def$Action.Obligation[def$b_Intl==1],na.rm=TRUE)/sum(def$Action.Obligation,na.rm=TRUE)
NA_stats(def,"b_Intl")`
* NAICS is a factor reporting the top North American Industrial Classification Code of each contract. 
`r summary(def$NAICS);
NA_stats(def,"NAICS")`
* Agency is a factor reporting the top Contracting Agency of each contract. 
`r summary(def$Agency);
NA_stats(def,"Agency")`
* Office is a factor reporting the top Contracting office of each contract. 
`r summary(def$Office);
NA_stats(def,"Office")`

### NAICS examination
```{r Summary, fig.width=7.5 , fig.height=3}

# Add NAICS title



def$NAICS_Code<-create_naics2(def$NAICS)

 def<-csis360::read_and_join(def,
                        lookup_file = "Lookup_NAICS_code.csv",
                        path="",
                        dir="Lookup\\",
                        by="NAICS_Code",
                        skip_check_var="NAICS_DESCRIPTION"
               )

def$NAICS_label<-paste(def$NAICS_Code,
                             def$NAICS_DESCRIPTION)

def$NAICS_label[
  def$NAICS_label==
    "56 Administrative and Support and Waste Management and Remediation Services"
  ]<-"56 Admin./Support/Waste Management and Remediation"
def$NAICS_label[def$NAICS_label==
                                    "NA NA"]<-"Unlabeled"

def$NAICS_label<-factor(def$NAICS_label)
order<-  rev(levels(def$NAICS_label))


NAICS2digit<-ggplot(def,
       aes(x=NAICS_label))+
  geom_bar()+coord_flip()+
  scale_y_continuous(label=scales::comma)+scale_x_discrete(limits=order)+
  labs(x="2-Digit NAICS Code",y="Number of Contracts and Task Orders in Unfiltered Dataset")

NAICS2digit
ggsave(NAICS2digit,file="Output\\NAICS2digitCount.png",width=10,height=6,dpi=600)

NAICS_summary<-def %>% group_by(NAICS,StartFY,HHI_lag1) %>%
  dplyr::summarise(annual_action_obligation=sum(Action.Obligation),
                   annual_count=length(StartFY)) 

top_NAICS <- NAICS_summary %>% group_by(NAICS) %>% 
  dplyr::summarise(naics_action_obligation=sum(annual_action_obligation),
                   naics_count=sum(annual_count)) 
top_NAICS$naics_dollar_rank<-rank(-top_NAICS$naics_action_obligation)
top_NAICS$naics_count_rank<-rank(-top_NAICS$naics_count)


NAICS_summary<-left_join(NAICS_summary,top_NAICS, by="NAICS")

colnames(NAICS_summary)[colnames(NAICS_summary)=="NAICS"]<-"principalnaicscode"

NAICS_summary$principalnaicscode<-as.character(NAICS_summary$principalnaicscode)
NAICS_summary<-as.data.frame(NAICS_summary)
NAICS_summary<-csis360::read_and_join(NAICS_summary,
                        lookup_file = "Lookup_PrincipalNAICScode.csv",
                        path="",
                        dir="Lookup\\",
                        by="principalnaicscode",
                        skip_check_var=c("principalnaicscodeText",
"NAICS_shorthand")
               )

# https://stackoverflow.com/questions/37174316/how-to-fit-long-text-into-ggplot2-facet-titles



# Helper function for string wrapping. 
# Default 20 character target width.
swr <- function(string, nwrap=20) {
  paste(strwrap(string, width=nwrap), collapse="\n")
}
swr <- Vectorize(swr)
summary(NAICS_summary$NAICS_shorthand)

# View(NAICS_summary)
NAICS_summary$NAICS_shorthand<-swr(NAICS_summary$NAICS_shorthand,nwrap = 25)
NAICS_summary$FY<-NAICS_summary$StartFY-1
NAICStop<-ggplot(subset(NAICS_summary,naics_dollar_rank<=4 |
                          naics_count_rank<=4),
       aes(x=FY,y=HHI_lag1))+#color=NAICS_Code
  geom_line()+
  scale_y_continuous(label=scales::comma)+ 
  scale_x_continuous(breaks=c(2006,2009,2011,2014))+
  labs(x="Fiscal Year",y="Herfindahl-Herschman Index")+ 
  geom_hline(yintercept=c(1500,2500),linetype="dotted")

NAICStop_paper<-NAICStop+ facet_wrap(~NAICS_shorthand,ncol=2)
ggsave(NAICStop_paper,file="Output\\NAICStop.png",width=4,height=8,dpi=600)

NAICStop_pp<-NAICStop+ facet_wrap(~NAICS_shorthand,ncol=4)
NAICStop_pp
ggsave(NAICStop_pp,file="Output\\NAICStop_pp.png",width=10.5,height=5.5,dpi=600)

summary(NAICS_summary$naics_count_rank)



```

### Variable examination
```{r VarGraph}


HH1plot<-freq_continuous_plot(def,"HHI_lag1",bins=50)
HH1plot<-HH1plot+geom_vline(xintercept=c(1500,2500))+labs(x="Annual Herfindahl-Hirschman Index (HHI) for NAICS-6 Sector",y="Contract or Task Order Count")
HH1plot
ggsave(HH1plot,file="Output//HH1freq.png",width=5.5,height=5.5,dpi=600)

sum(def$Action.Obligation[def$EffComp=="No Comp."],na.rm=TRUE)/sum(def$Action.Obligation,na.rm=TRUE)
sum(def$Action.Obligation[def$EffComp=="1 Offer"],na.rm=TRUE)/sum(def$Action.Obligation,na.rm=TRUE)
sum(def$Action.Obligation[def$EffComp=="2+ Offers"],na.rm=TRUE)/sum(def$Action.Obligation,na.rm=TRUE)
nrow(def[def$EffComp=="No Comp.",])/nrow(def)

sum(def$Action.Obligation[is.na(def$EffComp)],na.rm=TRUE)/sum(def$Action.Obligation,na.rm=TRUE)


# Effplot<-freq_discrete_plot(subset(def,"EffComp"))
# Effplot<-Effplot+labs(x="Effective Competition",y="Contract or Task Order Count")

# ggsave(Effplot,file="Output//EffFreq.png",width=5.5,height=5.5,dpi=600)

```

### Computational Sample Creation
```{r Sample}
 load(file="data//def_sample.Rdata")
# save(smp,smp1m,file="data//def_sample.Rdata")
smp$CYear<-smp$si
load("output//naics_join.Rdata")
      # contract$NAICS<-as.integer(as.character(contract$NAICS))
      smp<-left_join(smp,NAICS6_join, by=c("CYear"="CalendarYear",
                                                    "NAICS"="NAICS6"))

      #Remove 0s, they make no sense, source is be one contractors in subsector with <= 0 obligations, which is just missing data really
      contract$HHI_lag1[contract$HHI_lag1==0]<-NA
      contract$c_HHI_lag1<-scale(contract$HHI_lag1)

      contract$l_HHI_lag1<-log(contract$HHI_lag1)
      contract$cl_HHI_lag1<-scale(contract$l_HHI_lag1)


# complete<-!is.na(def$b_Term)&
#   !is.na(def$b_CBre)&
#   !is.na(def$n_Comp)&
#   !is.na(def$l_Ceil)&
#   !is.na(def$l_Days)&
#   !is.na(def$Veh) &
#   !is.na(def$n_Fixed)&
#   !is.na(def$b_Intl)&
#   !is.na(def$b_UCA)&
#   !is.na(def$NAICS)&
#   !is.na(def$NAICS2)&
#   !is.na(def$cl_HHI_lag1)
# 
# smp<-def[complete,]
# #8818392  to 8818392
# nrow(def[!complete,])/nrow(def)
# sum(def[!complete,]$Action.Obligation,na.rm=TRUE)/sum(def$Action.Obligation,na.rm=TRUE)
# 
# smp1m<-smp[sample(nrow(smp),1000000),]
# smp<-smp[sample(nrow(smp),250000),]
# save(file="data//def_sample.Rdata",smp,smp1m)
write.foreign(df=smp,
              datafile="Data//def_sample250k.dat",
              codefile="Data//def_sample250k_code.do",
              package = "Stata")
write.foreign(df=smp1m,
              datafile="Data//def_sample1m.dat",
              codefile="Data//def_sample1m_code.do",
              package = "Stata")

# levels(smp$Intl)<- list("Just U.S."=c("Just U.S."), 
#                                 "Any Intl."=c("Any International"))
# levels(smp1m$Intl)<- list("Just U.S."=c("Just U.S."), 
#                                 "Any Intl."=c("Any International"))


```
# Loading Models
## Output: Offers

### Consolidation and Number of Offers

```{r Comp-Cons}
load("Output//Comp_Cons_15C.rdata")


if(!exists("Comp_Cons_15C")){
  Comp_Cons_15C <- lmer (data=smp,
                         cl_Offr ~cl_def3_HHI_lag1+cl_def3_ratio_lag1+
                         # cl_US3_avg_sal_lag1+
                         cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+
                         cl_US6_avg_sal_lag1 + 
                         cl_Ceil+cl_Days+
                         Veh+
                         PricingFee+UCA+
                         b_Intl+
                         b_UCA:cl_def6_HHI_lag1 +
                         # cl_def6_HHI_lag1:cl_def6_ratio_lag1+
                         # cl_def6_HHI_lag1:cl_def6_obl_lag1+
                         b_Intl:Veh+
                         # cl_Ceil:PricingFee+
                         cl_US6_avg_sal_lag1:PricingFee+
                         # b_UCA:cl_Days+
                         # b_UCA:cl_Ceil+
                         (1 | NAICS3/NAICS) + (1 | Agency/Office),
                         verbose=1)
  save(Comp_Cons_15C,file="Output//Comp_Cons_15C.rdata")
}

#Considering 

glmer_examine(Comp_Cons_15C,display=TRUE)
```

## Output: Ceiling Breach
### Consolidation and Ceiling Breaches

```{r CBre-Cons}
load("Output//CBre_Cons_13B.rdata")


if(!exists("CBre_Cons_13B")){
  CBre_Cons_13B <- glmer (data=smp,
                          b_CBre ~cl_def3_HHI_lag1+cl_def3_ratio_lag1+#cl_def3_obl_lag1+
                            #cl_US3_avg_sal_lag1+
                            cl_def6_HHI_lag1+cl_def6_obl_lag1+cl_def6_ratio_lag1+
                            cl_US6_avg_sal_lag1+
                            cl_Ceil + cl_Days+ 
                            Veh +
                            PricingFee + b_UCA +
                            b_Intl+
                            
                            b_UCA:cl_def6_HHI_lag1 + 
                            b_UCA:cl_Ceil+
                            cl_def6_HHI_lag1:cl_def6_obl_lag1+
                            
                            (1 | NAICS3/NAICS) + 
                            (1 | Agency/Office), 
                          
                          family=binomial(link="logit"),
                          verbose=1)
  save(CBre_Cons_13B,file="Output//CBre_Cons_13B.rdata")
}

glmer_examine(CBre_Cons_13B,display=TRUE)
```

### Competition and Ceiling Breach
```{r CBre-Comp}
load(file="Output//CBre_Comp_13C.rdata")

glmer_examine(CBre_Comp_13C)


## Not Done
if(!exists("CBre_Comp_13C")){
  CBre_Comp_13C <- glmer (data=smp,
                          b_CBre ~CompOffr+cl_def3_ratio_lag1+#cl_US3_avg_sal_lag1+#cl_def3_obl_lag1+
                            cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                            cl_Ceil + cl_Days+
                            Veh  +
                            PricingFee+
                            b_UCA +
                            b_Intl+
                            
                            b_UCA:CompOffr +
                            b_UCA:cl_Ceil+
                            
                            (1 | NAICS3/NAICS) + (1 | Agency/Office),
                          family=binomial(link="logit"),
                          verbose=1)
  save(CBre_Comp_13C,file="Output//CBre_Comp_13C.rdata")
}

glmer_examine(CBre_Comp_13C,display=TRUE)
odds_ratio(CBre_Comp_13C,"CBre_Comp_13C")

```
VIF for cl_ceil:Veh is over 2, and for cl_Ceil is over 8, necessitating removal of a ceiling interaction.

### Both and Ceiling Breach
```{r CBre-Both}
load("Output//CBre_Cons_Comp_15A.rdata")


if(!exists("CBre_Cons_Comp_15A")){
  CBre_Cons_Comp_15A <- glmer (data=smp,
                               b_CBre ~cl_def3_HHI_lag1+cl_def3_ratio_lag1+#cl_def3_obl_lag1+
                                 #cl_US3_avg_sal_lag1+
                                 cl_def6_HHI_lag1+cl_def6_obl_lag1+cl_def6_ratio_lag1+
                                 cl_US6_avg_sal_lag1+
                                 CompOffr+
                                 cl_Ceil + cl_Days+ 
                                 Veh +
                                 PricingFee + b_UCA +
                                 b_Intl+
                                 
                                 
                                 
                                 b_UCA:CompOffr +
                                 b_UCA:cl_def6_HHI_lag1 + 
                                 b_UCA:cl_Ceil+
                                 cl_def6_HHI_lag1:cl_def6_obl_lag1+
                                 
                                 (1 | NAICS3/NAICS) + 
                                 (1 | Agency/Office) ,
                               family=binomial(link="logit"),
                               verbose=1)
  
  save(CBre_Cons_Comp_15A,file="Output//CBre_Cons_Comp_15A.rdata")
}

glmer_examine(CBre_Cons_Comp_15A,display=TRUE)
odds_ratio(CBre_Cons_Comp_15A,"CBre_Cons_Comp_15A")

```
VIF for cl_ceil:Veh is over 2, and for cl_Ceil is over 8, necessitating removal of a ceiling interaction.



## Output: Termination

### Consolidation and Termination

```{r Term-Cons}

load("Output//Term_Cons_13E.rdata")


if(!exists("Term_Cons_13E")){
  
  Term_Cons_13E <- glmer (data=smp,
                          b_Term ~cl_def3_HHI_lag1+cl_def3_ratio_lag1+#cl_def3_obl_lag1+
                            #cl_US3_avg_sal_lag1+
                            cl_def6_HHI_lag1+cl_def6_obl_lag1+cl_def6_ratio_lag1+
                            cl_US6_avg_sal_lag1+
                            cl_Ceil + cl_Days+ 
                            Veh +
                            PricingFee + b_UCA +
                            b_Intl+
                            
                            b_UCA:cl_def6_HHI_lag1 + 
                            b_UCA:cl_Ceil+
                            cl_def6_HHI_lag1:cl_def6_obl_lag1+
                            
                            (1 | NAICS3/NAICS) + 
                            (1 | Agency/Office), 
                          family=binomial(link="logit"),
                          verbose=1)
  
  
  save(Term_Cons_13E,file="Output//Term_Cons_13E.rdata")
  
}

glmer_examine(Term_Cons_13E,display=TRUE)
odds_ratio(Term_Cons_13E,"Term_Cons_13E")

```



### Competition and Terminations

```{r Term-Comp}
load(file="Output//Term_Comp_13E.rdata")

if(!exists("Term_Comp_13E2")){
  Term_Comp_13E2 <- glmer (data=smp,
                          b_Term ~CompOffr+cl_def3_ratio_lag1+#cl_US3_avg_sal_lag1+#cl_def3_obl_lag1+
                            cl_def6_ratio_lag1+cl_def6_obl_lag1+cl_US6_avg_sal_lag1+
                            cl_Ceil + cl_Days+
                            Veh  +
                            PricingFee+
                            b_UCA +
                            b_Intl+
                            
                            b_UCA:CompOffr +
                            b_UCA:cl_Ceil+
                            
                            (1 | NAICS3/NAICS) + (1 | Agency/Office),
                          family=binomial(link="logit"),
                          verbose=1)
  
  
  save(Term_Comp_13E,Term_Comp_13E2,file="Output//Term_Comp_13E2.rdata")
}

glmer_examine(Term_Comp_13E2,display=TRUE)
odds_ratio(Term_Comp_13E2,"Term_Comp_13E2")
```

### Both and Terminations

```{r Both-Term}
# load("Output//Comp_Cons_15A.rdata")
# 
# 
# #Not DOne
# if(!exists("Comp_Cons_15B")){
#   Comp_Cons_15B <- lmer (data=smp,
#                          cl_Offr ~cl_def3_HHI_lag1+cl_def3_ratio_lag1+
#                          # cl_US3_avg_sal_lag1+
#                          cl_def6_HHI_lag1+cl_def6_ratio_lag1+cl_def6_obl_lag1+
#                          cl_US6_avg_sal_lag1 + 
#                          cl_Ceil+cl_Days+
#                          Veh+
#                          PricingFee+UCA+
#                          b_Intl+
#                          b_UCA:cl_def6_HHI_lag1 +
#                          # cl_def6_HHI_lag1:cl_def6_ratio_lag1+
#                          # cl_def6_HHI_lag1:cl_def6_obl_lag1+
#                          b_Intl:Veh+
#                          # cl_Ceil:PricingFee+
#                          cl_US6_avg_sal_lag1:PricingFee+
#                          # b_UCA:cl_Days+
#                          # b_UCA:cl_Ceil+
#                          (1 | NAICS3/NAICS) + (1 | Agency/Office),
#                          verbose=1)
#   save(Comp_Cons_15A,file="Output//Comp_Cons_15A.rdata")
# }
# 
# glmer_examine(Comp_Cons_15B,display=TRUE)


```

# Tables for Paper
## Competition Model
```{r Output-CBre}

# texreg::htmlreg(list(Term_Cons_08A3,
#                   CBre_Cons_08C),#CBre_Cons_08B2
#                 file="Output//ConsModel.html",single.row = TRUE,
#                 custom.model.name=c("Termination",
#                                     "Ceiling Breach"),
#                         stars=c(0.05))


texreg::htmlreg(list(Comp_Cons_15C),file="Output//Offr_Model.html",single.row = TRUE,
                custom.model.name=c("Consolidation"),
                        stars=c(0.05,0.01,0.001))


  # OR_m1SD <- exp(fixef(FM_m1SD))
  # CI_m1SD <- exp(confint(FM_m1SD,parm="beta_")) 
  # 
  # OR_p1SD <- exp(fixef(FM_p1SD))
  # CI_p1SD <- exp(confint(FM_p1SD,parm="beta_")) 
  # 
  # OR.CI<-rbind(cbind(OR,CI), cbind(OR_m1SD,CI_m1SD)[3,], cbind(OR_p1SD,CI_p1SD)[3,])
  # rownames(OR.CI)<-c(rownames(cbind(OR,CI)), "teacher_fan_c_m1SD", "teacher_fan_c_p1SD")
  # OR.CI

# htmlreg(list(EuropeModel$fixed[[1]],EuropeModel$fixed[[2]],EuropeModel$fixed[[3]]),
#         file="Output\\Hypothesis1.html",
#         custom.model.name=c(as.character(EuropeModel$name[1:3])),
#         digits=3,
#         stars=c(0.001,0.01,0.05,0.1),
#         custom.coef.names = c("More Def. Spending",#Dlog(NGDPPC_eu2014)
#                               "Log(GDP), (2014 Euros)", #log(NGDP_eu2014)
#                               "EU27-wide Debt, (Percent of EU 27 GDP)",# EUdebt_NGDP
#                               "Deficit, (Percent of GDP)",# Dfc_NGDP
#                               "International Terrorism, (Number of Incidents)", #IntAt
#                               "Log(Global Civil War Battle-Related Deaths)", # log(GCivilWarBRD)
#                               "Cabinet Liberty/Authority, (GAL=0, TAN=10)", #Cab_liberty_authority
#                               "Liberty/Authority Polarization", #liberty_authority_ls_spread
#                               "Cabinet Anti/Pro EU, (Anti=0, Pro=10)"), #Cab_liberty_authority)
#         groups = list("Public Net Support for (year T-2)" = 1,"Macroeconomics (year T-1)" = 2:4,"Security (year T-1)" = 5:6,"Parliamentary (year T-1)" = 7:9),
#         custom.note="%stars.",
#             bold=0.05
# )


```

## Ceiling Breach Model
```{r Output-CBre}

# texreg::htmlreg(list(Term_Cons_08A3,
#                   CBre_Cons_08C),#CBre_Cons_08B2
#                 file="Output//ConsModel.html",single.row = TRUE,
#                 custom.model.name=c("Termination",
#                                     "Ceiling Breach"),
#                         stars=c(0.05))


# texreg::htmlreg(list(CBre_Cons_13B,CBre_Comp_13C,CBre_Cons_Comp_15A),file="Output//CBre_Model.html",single.row = TRUE,
#                 custom.model.name=c("Consolidation",
#                                     "Competition",
#                                     "Both"),
#                         stars=c(0.05,0.01,0.001))


texreg::htmlreg(list(CBre_Cons_13B,CBre_Comp_13C,CBre_Cons_Comp_15A),file="Output//CBre_Model.html",
                single.row = TRUE,
                custom.model.name=c("Consolidation",
                                    "Competition",
                                    "Both"),
                        stars=c(0.1,0.05,0.01,0.001),
                groups = list("Study Variables" = 2:7,
                              "NAICS Characteristics" = 8:11,
                              "Contract Characteristics"=12:24,
"Interactions" = 25:31),
                custom.coef.map=list("(Intercept)"="(Intercept)",
                "cl_def3_HHI_lag1"="Log(Subsector HHI)",
"cl_def6_HHI_lag1"="Log(Det. Ind. HHI)",
"CompOffr1 offer"="Comp=1 offer",
"CompOffr2 offers"="Comp=2 offers",
"CompOffr3-4 offers"="Comp=3-4 offers",
"CompOffr5+ offers"="Comp=5+ offers",
"cl_def3_ratio_lag1"="Log(Subsector Ratio)",
"cl_def6_obl_lag1"="Log(Det. Ind. Def. Obl.)",
"cl_def6_ratio_lag1"="Log(Det. Ind. Ratio)",
"cl_US6_avg_sal_lag1"="Log(Det. Ind. U.S. Avg. Salary)",
"cl_Ceil"="Log(Init. Ceiling)",
"cl_Days"="Log(Init. Days)",
"VehS-IDC"="Vehicle=S-IDC",
"VehM-IDC"="Vehicle=M-IDC",
"VehFSS/GWAC"="Vehicle=FSS/GWAC",
"VehBPA/BOA"="Vehicle=BPA/BOA",
"PricingFeeOther FP"="Pricing=Other FP",
"PricingFeeIncentive"="Pricing=Incentive Fee",
"PricingFeeCombination or Other"="Pricing=Combination or Other",
"PricingFeeOther CB"="Pricing=Other CB",
"PricingFeeT&M/LH/FPLOE"="Pricing=T&M/LH/FP:LoE",
"b_UCA"="UCA",
"b_Intl"="Performed Abroad",
# "cl_def6_HHI_lag1:cl_Days"="Log(Det. Ind. HHI):Log(Init. Days)",
"cl_def6_HHI_lag1:cl_def6_obl_lag1"="Log(Det. Ind. HHI):Log(Det. Ind. Def. Obl.)",
# "cl_def3_HHI_lag1:cl_def3_ratio_lag1"="Log(Subsector HHI):Log(Subsector Ratio)"),
"cl_def6_HHI_lag1:b_UCA"="Log(Det. Ind. HHI):UCA",
"cl_Ceil:b_UCA"="Log(Init. Ceiling):UCA",
"CompOffr1 offer:b_UCA"="Comp=1 offer:UCA",
"CompOffr2 offers:b_UCA"="Comp=2 offers:UCA",
"CompOffr3-4 offers:b_UCA"="Comp=3-4 offers:UCA",
"CompOffr5+ offers:b_UCA"="Comp=5+ offers:UCA"
),
                bold=0.05,
custom.note="%stars. Logged inputs are rescaled.",
caption="Table 2: Logit Model Results for Ceiling Breaches",
caption.above=TRUE)





# htmlreg(list(EuropeModel$fixed[[1]],EuropeModel$fixed[[2]],EuropeModel$fixed[[3]]),
#         file="Output\\Hypothesis1.html",
#         custom.model.name=c(as.character(EuropeModel$name[1:3])),
#         digits=3,
#         stars=c(0.001,0.01,0.05,0.1),
#         custom.coef.names = c("More Def. Spending",#Dlog(NGDPPC_eu2014)
#                               "Log(GDP), (2014 Euros)", #log(NGDP_eu2014)
#                               "EU27-wide Debt, (Percent of EU 27 GDP)",# EUdebt_NGDP
#                               "Deficit, (Percent of GDP)",# Dfc_NGDP
#                               "International Terrorism, (Number of Incidents)", #IntAt
#                               "Log(Global Civil War Battle-Related Deaths)", # log(GCivilWarBRD)
#                               "Cabinet Liberty/Authority, (GAL=0, TAN=10)", #Cab_liberty_authority
#                               "Liberty/Authority Polarization", #liberty_authority_ls_spread
#                               "Cabinet Anti/Pro EU, (Anti=0, Pro=10)"), #Cab_liberty_authority)
#         groups = list("Public Net Support for (year T-2)" = 1,"Macroeconomics (year T-1)" = 2:4,"Security (year T-1)" = 5:6,"Parliamentary (year T-1)" = 7:9),
#         custom.note="%stars.",
#             bold=0.05
# )


```


## Terminations Model
```{r Output-CBre}

# texreg::htmlreg(list(Term_Cons_08A3,
#                   CBre_Cons_08C),#CBre_Cons_08B2
#                 file="Output//ConsModel.html",single.row = TRUE,
#                 custom.model.name=c("Termination",
#                                     "Ceiling Breach"),
#                         stars=c(0.05))

texreg::htmlreg(list(Term_Cons_13E,Term_Comp_13E2),file="Output//Term_Model.html",
                single.row = TRUE,
                custom.model.name=c("Consolidation",
                                    "Competition"#,
                                    #"Both"
                                    ),
                        stars=c(0.1,0.05,0.01,0.001),
                groups = list("Study Variables" = 2:7,
                              "NAICS Characteristics" = 8:11,
                              "Contract Characteristics"=12:24,
                              # "Contract Initial Scope" = 12:13,
                              # "Contract Vehicle (Baseline=Def. Award" = 14:18,
                # "Contract Pricing (Baseline=FFP)" = 19:24,
# "Place of Performance" = 25,
"Interactions" = 25:27),
                custom.coef.map=list("(Intercept)"="(Intercept)",

                "cl_def3_HHI_lag1"="Log(Subsector HHI)",
"cl_def6_HHI_lag1"="Log(Det. Ind. HHI)",

"CompOffr1 offer"="Comp=1 offer",
"CompOffr2 offers"="Comp=2 offers",
"CompOffr3-4 offers"="Comp=3-4 offers",
"CompOffr5+ offers"="Comp=5+ offers",
                                     "cl_def3_ratio_lag1"="Log(Subsector Ratio)",
"cl_def6_obl_lag1"="Log(Det. Ind. Def. Obl.)",
"cl_def6_ratio_lag1"="Log(Det. Ind. Ratio)",
"cl_US6_avg_sal_lag1"="Log(Det. Ind. U.S. Avg. Salary)",
"cl_Ceil"="Log(Init. Ceiling)",
"cl_Days"="Log(Init. Days)",
"VehS-IDC"="Vehicle=S-IDC",
"VehM-IDC"="Vehicle=M-IDC",
"VehFSS/GWAC"="Vehicle=FSS/GWAC",
"VehBPA/BOA"="Vehicle=BPA/BOA",
"PricingFeeOther FP"="Pricing=Other FP",
"PricingFeeIncentive"="Pricing=Incentive Fee",
"PricingFeeCombination or Other"="Pricing=Combination or Other",
"PricingFeeOther CB"="Pricing=Other CB",
"PricingFeeT&M/LH/FPLOE"="Pricing=T&M/LH/FP:LoE",
"b_UCA"="UCA",
"b_Intl"="Performed Abroad",
"cl_def6_HHI_lag1:cl_Days"="Log(Det. Ind. HHI):Log(Init. Days)",
"cl_def6_HHI_lag1:cl_def6_obl_lag1"="Log(Det. Ind. HHI):Log(Det. Ind. Def. Obl.)",
"cl_def3_HHI_lag1:cl_def3_ratio_lag1"="Log(Subsector HHI):Log(Subsector Ratio)"),

                bold=0.05,
custom.note="%stars. Logged inputs are rescaled.",
caption="Table 3: Logit Model Results for Terminations",
caption.above=TRUE)




# htmlreg(list(EuropeModel$fixed[[1]],EuropeModel$fixed[[2]],EuropeModel$fixed[[3]]),
#         file="Output\\Hypothesis1.html",
#         custom.model.name=c(as.character(EuropeModel$name[1:3])),
#         digits=3,
#         stars=c(0.001,0.01,0.05,0.1),
#         custom.coef.names = c("More Def. Spending",#Dlog(NGDPPC_eu2014)
#                               "Log(GDP), (2014 Euros)", #log(NGDP_eu2014)
#                               "EU27-wide Debt, (Percent of EU 27 GDP)",# EUdebt_NGDP
#                               "Deficit, (Percent of GDP)",# Dfc_NGDP
#                               "International Terrorism, (Number of Incidents)", #IntAt
#                               "Log(Global Civil War Battle-Related Deaths)", # log(GCivilWarBRD)
#                               "Cabinet Liberty/Authority, (GAL=0, TAN=10)", #Cab_liberty_authority
#                               "Liberty/Authority Polarization", #liberty_authority_ls_spread
#                               "Cabinet Anti/Pro EU, (Anti=0, Pro=10)"), #Cab_liberty_authority)
#         groups = list("Public Net Support for (year T-2)" = 1,"Macroeconomics (year T-1)" = 2:4,"Security (year T-1)" = 5:6,"Parliamentary (year T-1)" = 7:9),
#         custom.note="%stars.",
#             bold=0.05
# )


```