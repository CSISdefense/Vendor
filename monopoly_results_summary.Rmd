---
title: "Monopoly Results Summary"
date: "Wednesday, February 8, 2017"
output: 
  html_document: 
    keep_md: yes
    toc: yes

---

#Setup
```{r Libraries, echo = FALSE}
library(csis360)
library(ggplot2)
library(dplyr)
library(arm)
library(R2WinBUGS)
library(knitr)
source("DIIGstat.r")

axis.text.size<-10
strip.text.size<-10
legend.text.size<-8
# table.text.size<-5.75
title.text.size<-12
geom.text.size<-12

main.text.size<-1
note.text.size<-1.40


```


Contracts are classified using a mix of numerical and categorical variables. While the changes in numerical variables are easy to grasp and summarize, a contract may have one line item that is competed and another that is not. As is detailed in the exploration on R&D, we are only considering information available prior to contract start. The percentage of contract obligations that were competed is a valuable benchmark, but is highly influenced by factors that occured after contract start..

## Contract Terminations

Contract terminations and the number of change orders can be calculated for the entire sample.  Contract termination is determined using the *Reason for Modification* field in FPDS.  A contract is considered to be terminated if it has at least one modification with the following values:

* "Terminate for Default (complete or partial)"
* "Terminate for Convenience (complete or partial)"
* "Terminate for Cause"
* "Legal Contract Cancellation"

These four catetegories and the "Close Out" category are used to mark a contract as closed.  Many contracts in FPDS and in the sample are never marked closed.  


##Prepare Data
First we load the data. The dataset used is a U.S. Defense Contracting dataset derived from   FPDS.


###Data Transformations and Summary



```{r ReadInData, echo = TRUE}
  load(file="Data/defense_contract_CSIScontractID_detail.Rdata")
# head(def)
# debug(transform)
def<-transform_contract(def)
# save(file="Data/transformed_def.Rdata", def)
 load(file="Data/transformed_def.Rdata")
```





NA_stats(def,"b_CBre")

* b_CBre is a binary variable that has a value of 1 for any contracts that have experienced a partial or complete termination, 0 otherwise. (`r summary(def$b_CBre)
NA_stats(def,"b_CBre")`)
* n_Comp is a binary variable based on competition. It has a value of 0 for uncompeted contracts and a value of 1 for competition, regardless of number of offers. `r  summary(def$n_Comp);
NA_stats(def,"b_Comp")`
* c_hh_index_lag1 is a numeric variable based on competition and number of offers. It has a value of 0 for uncompeted contracts and a value of 1 for single-offer competition, and a value of 2 for multi-offer competition. `r summary(def$c_hh_index_lag1);
NA_stats(def,"c_hh_index_lag1")`
* n_Offr is a numeric variable based on competition and with more granularity on number offers. It has a value of 0 for uncompeted contracts and a value of 1 for single-offer competition, and a value of 2 for 2-offers, 3 for 3-4 offers, and 4 for 5+ offers. `r summary(def$n_Offr);
NA_stats(def,"n_Offr")`
* cl_Ceil is the natural log of the initial contract cost ceiling, in then-year dollars. `r centered_log_description(def$l_Ceil,"dollars");
NA_stats(def,"l_Ceil")`
* cl_Days is the natural log of the initial maximum duration of the contract, in days. The variable is centered, by subtracting its mean (`r centered_log_description(def$l_Days,"days");
NA_stats(def,"l_Days")` 
* SIDV, MIDV, and OIDV are dummy variables based on the contract vehicle. They correspond to Single-Award IDVs, Multi-Award IDVs, and Other IDVs, respectively, having a value of 1 when the task order has that vehicle type, and having a 0 other. The remaining types, definitive contracts and purchase orders, are intentionally left out. (`r summary(def$SIDV);
summary(def$MIDV);
summary(def$OIDV);
NA_stats(def,"Veh")`
* n_Fixed is a numeric variable based on contract pricing. It has a value of 0 for cost-based, 0.5 or "combination or other", 1 for any fixed price (excluding fixed-price level of effort which is classified as cost-based). (`r summary(def$n_Fixed);
NA_stats(def,"n_Fixed")`)
* n_Incent is a numeric variable based on fee type. Ig has a value. 1 for incentive fee or cost sharing, 0.5 or "combination or other", 0 for all remaining types. (`r summary(def$n_Incent);
NA_stats(def,"n_Incent")`)
* b_UCA is a binary variable with a value of 1 for contracts/task orders that begin as letter contracts or undefinitized contract awards (UCA) and a value of 0 otherwise. `r summary(def$b_UCA);
NA_stats(def,"b_UCA")`
* b_Intl is a binary variable with a value of 1 for contracts/task orders with any transactions performed internationally and a value of 0 otherwise. `r summary(def$b_Intl);
NA_stats(def,"b_Intl")`
* NAICS is a factor reporting the top North American Industrial Classification Code of each contract. 
`r summary(def$NAICS);
NA_stats(def,"NAICS")`
* Agency is a factor reporting the top Contracting Agency of each contract. 
`r summary(def$Agency);
NA_stats(def,"Agency")`
* Office is a factor reporting the top Contracting office of each contract. 
`r summary(def$Office);
NA_stats(def,"Office")`



###Computational Sample Creation
```{r Sample}


complete<-!is.na(def$b_Term)&
                                     !is.na(def$b_CBre)&
                                  !is.na(def$EffComp)&
                                  !is.na(def$l_Ceil)&
                                  !is.na(def$l_Days)&
                                    !is.na(def$Veh) &
                                  !is.na(def$n_Fixed)&
                                    !is.na(def$b_Intl)&
                                  !is.na(def$NAICS)

smp<-def[complete,]
#8818392  to 8818392
nrow(def[!complete,])/nrow(def)
sum(def[!complete,]$Action.Obligation,na.rm=TRUE)/sum(def$Action.Obligation,na.rm=TRUE)

smp<-smp[sample(nrow(smp),250000),]


```



```{r Comp_Term}




#Create the model
Term_Comp_05A <- glm (data=smp,
                 b_Term ~n_Comp + 
                   cl_Ceil + cl_Days+ 
                   SIDV + MIDV + OIDV +
                   n_Comp:cl_Ceil  + cl_Ceil:cl_Days  + n_Comp:cl_Days +
                   n_Fixed + 
                   b_Intl + 
                   SIDV:cl_Days+MIDV:cl_Days+OIDV:cl_Days +
                   SIDV:n_Comp+MIDV:n_Comp+OIDV:n_Comp
                    , family=binomial(link="logit"))
display(Term_Comp_05A)

```